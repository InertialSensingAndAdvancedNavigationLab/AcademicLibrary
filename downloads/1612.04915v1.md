## **Collaborative Object Transportation Using MAVs via Passive Force** **Control**

Andrea Tagliabue [1], Mina Kamel [1], Sebastian Verling [1], Roland Siegwart [1], Juan Nieto [1]



_**Abstract**_ **— This paper shows a strategy based on passive**
**force control for collaborative object transportation using Micro**
**Aerial Vehicles (MAVs), focusing on the transportation of a**
**bulky object by two hexacopters. The goal is to develop a**
**robust approach which does not rely on: (a) communication**
**links between the MAVs, (b) the knowledge of the payload**
**shape and (c) the position of grasping point. The proposed**
**approach is based on the master-slave paradigm, in which the**
**slave agent guarantees compliance to the external force applied**
**by the master to the payload via an admittance controller. The**
**external force acting on the slave is estimated using a non-linear**
**estimator based on the Unscented Kalman Filter (UKF) from**
**the information provided by a visual inertial navigation system.**
**Experimental results demonstrate the performance of the force**
**estimator and show the collaborative transportation of a** 1 _._ 2 **m**
**long object.**


I. INTRODUCTION


MAVs have recently stimulated the fantasy of researchers
and entrepreneurs [1][2] as a new tool for good delivery.
Quadcopters and hexacopters have shown to be especially
suited for this task, thanks to their ability to navigate in cluttered environments [3] and being able to deliver a payload
with extreme accuracy [4]. However, their inherent limited
size constrain the range of applications to the transportation
of small and light-weight objects.
Collaborative strategies can significantly enhance MAV
transportation capabilities and can provide a cost effective
solution with respect to the deployment of a single, more
capable MAV [5]. A common approach for collaborative
transportation is based on centralized solutions, where a
coordinator computes a control action for each of the agents
and it shares the command with them [6]. A second possible
approach is based on distributed control algorithm. In this
case, the agents only share a common goal and the individual
control laws are obtained with respect to the grasping point
on the payload [7].
Both of the described collaborative approaches, however,
present some limitations. Centralized approaches rely on the
ability of the coordinator to effectively communicate with
the agents and this can often be an issue due to the limited
robustness of wireless communication networks. Distributed

approach, instead, relies on the knowledge of the relative
position between each agent and the payload.
In this paper we overcame these issues by showing a
bio-inspired [8] collaborative approach based on the masterslave(s) paradigm. We chose one of the available MAVs to
be the leader - the master - while the remaining agents


1 Autonomous Systems Lab., Department of Mechanical and Process
Engineering, ETH Zurich, Zurich, Switzerland.



Fig. 1: Experimental setup for collaborative object transportation. The master vehicle is controlled remotely, while
the slave provides compliance to the movement of the master
using an admittance controller.


act as slaves. The task of the master is simply to lift the
payload and pull it in the desired direction. The slaves which are also attached to the payload - actively guarantee
compliance to the master’s actions by sensing the force that
master applies on the payload and changing their position
accordingly. Slave’s active compliance is guaranteed through
an admittance controller, while external forces are estimated
via position, velocity, attitude and angular velocity information using an estimator based on the UKF. To obtain the pose
of the MAV, as well as its velocity and angular velocity, we
use a visual-inertial navigation system mounted on the slave

agent.
In our setup we assume the following: (a) the payload
is big enough to guarantee that at least two MAVs can
autonomously grasp it, (b) all the agents are already attached
to the payload and (c) the attitude of the vehicle is decoupled
from the rotational dynamic of the payload - this is achieved,
for example, by connecting vehicle and payload via a rope
or a spherical joint [9].


_A. Contributions_


The main contribution of this work is the novel approach for collaborative object transportation using MAVs.
The approach that we propose has the advantage of not
relying on: (a) communication links between the MAVs,
(b) the knowledge of the payload shape, (c) the position of
grasping point, and is potentially scalable to multiple agents.
To effectively demonstrate our approach, we describe the
implementation of a force estimator based on the UKF which
handles quaternions, is computationally light, and fast. It is


able to detect a collision with a wall in less than 20 ms

and provides an accurate enough force estimate for humanvehicle interaction without relying on an external motion
capture system, but using a VI (Visual Inertial) navigation

system.


_B. Structure of this work_


We start by presenting existing approaches and technologies for cooperative transportation via MAV in Section II.
We then proceed by providing an overview of the control
strategy and architecture in Section III and we detail the implementation of the force estimator and admittance controller
in Sections IV and V, respectively. We conclude by showing
experimental results in Section VI and conclusion in Section
VII.


II. RELATED WORK


Literature for collaborative transportation via aerial vehicle
is rich of examples. Earliest publications are related to
collaborative transportation of a single payload using two
helicopters [10] [11], but do not provide experimental results.
Collaborative transportation using UAVs are extensively discussed by [5] and [12]. [6] makes use of a centralized
cooperative strategy which relies on communication between
MAVs while an example of distributed strategy based on
information about the payload shape and grasping points is
provided by [7].
In terms of passive force control and admittance control,
a comprehensive description is provided in [13]. [14] describes an example of admittance control for quadcopters
and human-machine interaction, but heavily relies on motion
capture systems for the force estimation.
An external forces and torque estimator for multirotor
vehicles based on the UKF and similar to the one we propose
is adressed on [15], which relies on the work of [16] for
attitude quaternion estimation.


III. SYSTEM DESIGN


_A. The Master-Slave Paradigm_


The master-slave paradigm is a common communication
approach for cooperative tasks and is used in many different
fields, from industries, informatics to the railway sector.
In our context, we defined it as follows. We divide the
agents (the MAVs) which take part in the collaborative
transportation maneuver in two categories, (a) master and
(b) slave. The master, which is unique, follows a reference
trajectory given by an external operator or a path planning
algorithm while grasping, lifting and pulling the payload. It
executes its standard on-board reference tracking and state
estimation algorithms and it behaves as if it was carrying
the payload alone. The slave agent - which can be one or
more - instead grasps the payload, detects the magnitude and
direction of the force that the master is applying on it and
generates a trajectory compliant with the force applied by
the master.

Master and slave do not share information via a conven
tional communication link, but rather via the force applied



Fig. 3: Reference frames defined for this work. _I_ represents
the inertial reference frame, while _B_ the MAV reference

frame.


to the payload, which is sensed by the slave through a force
estimator.


_B. Slave Control Architecture_


From now on we will focus our attention on the control ar
chitecture of the slave agent, since the master runs a standard
pose tracking feedback loop. Slave’s control architecture is
composed by four main building blocks.


_•_ **State estimator** : estimates the slave’s (a) position,
(b) velocity, (c) attitude, and (d) angular velocity w.r.t
the _I_ frame. It can either be an external motion capture
system such as [17] or a VI navigation system. The
attitude is expressed as a quaternion.

_•_ **Force and torque estimator** : estimates the external
force acting on the slave expressed in _I_ frame and
external torque around _z_ _B_ axis in _B_ frame. Additionally
to the full output of the state estimator - which is used
in the update step - the force and torque estimator needs
the measurement of the speed of the rotors to propagate
the model dynamics in the state prediction step.

_•_ **Admittance controller** : provides a reference pose (position and attitude) for the MAV position and attitude
controller, given the estimate of the external force
and torque and a desired trajectory. According to the
choice of its parameters, it can better track the desired
trajectory or give full compliance to the estimated external disturbances. For example, during the cooperative
transportation, it complies fully to the force components
on _x_ _I_ and _y_ _I_ axis while tracking an altitude reference
on _z_ _i_ . More details can be found in Section V.

_•_ **Position and attitude controller** : MPC based con
troller, that tracks the trajectory generated by the admittance controller by providing a rotor speed command.


_C. Coordinate System_


The relevant coordinate frames for this work are two: an

inertial reference frame attached to the ground _I_ and a noninertial reference frame attached to the Center of Gravity
(CoG)of the vehicle _B_ . They are represented in Figure 3.


_D. Hardware and Software_


_a) Hardware:_ The MAV used for our experiments is
the **AscTec Firefly hexacopter** equipped with an on board
computer based on a **quad-core 2.1 GHz Intel i7** processor


Fig. 2: Active interaction control scheme for the slave agent. The user-provided desired trajectory is modified by the
admittance controller according to the external force and torque estimated by the UKF filter based estimator. The state
estimator can be either based on a visual-inertial navigation system or an external motion capture system.



and **8 GB of RAM** . The hexacopter is additionally equipped
with a Visual-Inertial navigation system, developed by the
Autonomous Systems Lab at ETHZ and Skybotix AG [18].
This sensor measurement, fused with vehicle’s IMU provide
a 100 Hz estimate of: (a) position, (b) velocity, (c) attitude,
(d) angular velocity of the MAV.
_b) Software:_ We implemented the force estimator and
the admittance controller algorithm using **C++ and ROS** .
All the algorithms run on board the hexacopter to avoid
issues related to wireless communication. Both the force

estimator and the admittance controller run at **100 Hz** using
about 10% of the available computational power together.
The position and attitude controller is based on the model
predictive controller developed in [19], [20].


IV. EXTERNAL FORCE AND TORQUE ESTIMATOR


In this section, we present the UKF that was implemented
to estimate the external force and torque acting on the MAV.
First, we derive a nonlinear, discrete time model of the
rotational and translational dynamics of a hexacopter, to be
used in the derivation of the process model of the filter.
Second, we derive the measurement model to be used in
the update step. Third, we describe the prediction and update
step for the whole state of the filter with the exception of the
attitude quaternion. In the end, we describe the singularity
free prediction and update steps which take into account the
attitude quaternion.


_A. Hexacopter Model with External Force and Torque_


_c) Model Assumptions:_ In order to simplify the model
derivation, we assume that:


_•_ The MAV structure is rigid, symmetric on the _x_ _B_ _y_ _B_
and _y_ _B_ _z_ _B_ planes, and the CoG (Center of Gravity) and
body frame origin _B_ coincide;

_•_ Aerodynamic interaction with the ground or other surfaces can be neglected and we only consider aerodynamic effects dominant at low speed;




_•_ No external torque acts around _x_ _B_ and _y_ _B_ axis.


In addition, we define the rotation matrix from frame _B_
to frame _I_ as _**R**_ **(** _**q**_ **)** _[I]_ _B_ [, where] _**[ q]**_ [ is the normalized quaternion]
representing the attitude of the vehicle. Finally, we simplify
the equations by introducing _U_ 1, _U_ 2 and _U_ 3 as the total
torque produced by the propellers around, respectively, _x_ _b_, _y_ _b_
and _z_ _b_, and _U_ 4 as the total thrust produced by the propellers
expressed in _B_ frame. We compute _U_ _i_ _, i_ = 1 _. . ._ 4 from the
rotor speed _n_ _i_, _i_ = 1 _. . ._ 6, using the allocation matrix, as
defined in [21] for the AscTec Firefly hexacopter [22]:















_U_ 1

 _U_ 2

_U_ 3

 _U_ 4





 = **K**



_s_ 1 _s_ _−s_ _−_ 1 _s_

_−c_ 0 _c_ _c_ 0 _−c_

_−_ 1 1 _−_ 1 1 _−_ 1 1

1 1 1 1 1 1



 _n_ 1 [2]

...

 _n_ 6 [2]





 (1)



**K** = diag�� _lk_ _n_ _lk_ _n_ _k_ _n_ _k_ _m_ _k_ _n_ �) (2)



where _l_ is the boom length, _k_ _n_ and _k_ _m_ are rotor constants
and _c_ = cos(30 deg) and _s_ = sin(30 deg).
_d) Translational Dynamics:_ We derive the linear acceleration with respect to _I_ reference frame by taking into
account the following forces: (a) gravity, (b) thrust, (c)
aerodynamic effects, (d) external forces due to interaction
with the vehicle. We obtain:


_x_ ¨ 0 0

¨

  [1] _[I]_  _[aero]_   [1]

[]



_−_



_m_ _**[F]**_ _[ ext]_ [ (3)]







_B_
_m_ _**[R]**_ **[(]** _**[q]**_ **[)]** _[I]_



_x_ ¨

¨



_y_
_z_ ¨








 + _**F**_ _[aero]_

 �







+ [1]




= [1]




� [] 



0

0

[]  _U_ 4







00

 _g_



where _**F**_ _[ext]_ are the external forces that act on the vehicle

expressed in _I_ reference frame, _m_ is the mass of the vehicle,
and _**F**_ _[aero]_ is defined as:







(4)








_x_ ˙

˙



_y_
0




_**F**_ _[aero]_ = _k_ _drag_



6
� _|n_ _i_ _|_


_i_ =1


_e) Rotational Dynamics:_ We derive the angular acceleration ˙ _**ω**_ in _B_ frame by taking into account the following
torques: (a) total torque produced by propellers, (b) external
torque around z axis, (c) inertial effects, (d) propeller’s
gyroscopic effects. We obtain:



 _−_ _**ω**_ _×_ **J** _**ω**_ _−_ _**τ**_ _**[rotor]**_

 �



_U_ 1


**˙**
_**ω**_ = **J** _[−]_ [1] _U_ 2
� []  _U_ 3





+








 00

_τ_ _[ext]_




(5)



We assume that the change of external force and torque is
purely driven by zero mean additive process noise, whose
covariance is a tuning parameter of the filter. The external
force and torque are updated according to

_**F**_ _[ext]_ _k_ +1 [=] _**[ F]**_ _[ ext]_ _k_ (16)
_τ_ _k_ _[ext]_ +1 [=] _[ τ]_ _[ ext]_ _k_


or by assuming an exponential force decaying model

_τ_ _**F**_ _k_ _[ext][ext]_ _k_ +1+1 [=][=] _[ τ]_ _**[ F]**_ _[ ext]_ _k_ _[ ext]_ _k_ (1 [(1] _−_ _[ −]_ _T_ _s_ _[T]_ _/_ _[s]_ _τ_ ¯ _[/]_ ) _[τ]_ [¯][)] (17)


where ¯ _τ_ is a constant set by the user and defines the convergence speed of the estimates. In order to define the state
covariance and the process noise covariance, we introduce a
new representation ¯ _**s**_ _k_ of the state _**s**_ _k_, where we substitute the
attitude quaternion _**q**_ _k_ with a 3 _×_ 1 attitude error vector _**e**_ _k_ .
More details about this substitution are explained in IV-D.


_**s**_ ¯ _k_ = � _**p**_ _k_ _**v**_ _k_ _**e**_ _k_ _**ω**_ _k_ _**F**_ _[ext]_ _k_ _τ_ _k_ _[ext]_ � (18)


We can now introduce _**P**_ _k_, the 16 _×_ 16 covariance matrix
associated to the state ¯ _**s**_ _k_, and _**Q**_, the 16 _×_ 16 time invariant
process noise diagonal covariance matrix.
_h) Measurement Model:_ We define the measurement
vector _**z**_ _k_, the associated 12 _×_ 12 measurement noise co
variance matrix _**R**_ and the linear measurement function

_**z**_ _k_ = _**Hs**_ ¯ _k_ + _**v**_ _k_, under the assumption that the measurements
are subject to zero-mean additive noise.


_**z**_ _k_ = � _**p**_ _[m]_ _k_ _**v**_ _[m]_ _k_ _**e**_ _[m]_ _k_ _**ω**_ _[m]_ _k_ � (19)


_**z**_ _k_ = _**Hs**_ ¯ _k_ + _**v**_ _k_
(20)
_**H**_ = � **I** 12 _×_ 12 **0** 12 _×_ 4 �


_**R**_ = diag(� **1** _[T]_ 3 _[σ]_ _m,p_ [2] **1** _[T]_ 3 _[σ]_ _m,v_ [2] **1** _[T]_ 3 _[σ]_ _m,e_ [2] **1** _[T]_ 3 _[σ]_ _m,ω_ [2] �) (21)


As a remark, we observe that the measured attitude
quaternion is converted in a three states parametrization _**e**_ _k_
for the measurement vector. In addition, the measurement
update step of the filter is performed using the state vector
_**s**_ ¯ _k_ . (IV-C.0.j).


_C. Position, Velocity, Angular Velocity, External Force and_
_Torque Estimation_


**Notation Declaration:** From now on, we will use the
following notation:

_•_ ˆ _**s**_ [+] _k−_ 1 [denotes the estimated state before the prediction]
step

_•_ ˆ _**s**_ _[−]_ _k_ [denotes the estimated state after the prediction step]
and before the update step

_•_ ˆ _**s**_ [+] _k_ [denotes the estimated state after the update step]

The same applies for the state covariance matrix _**P**_ .
_i) Prediction Step:_ The predicted state for all the states
with the exception of the attitude is computed using the
standard UKF prediction step, as explained in [24] and

[25]. The matrix square root is computed using the Cholesy
decomposition [24].



where _τ_ _ext_ is the external torque around the _z_ _B_ axis. **J** is the
inertia tensor of the MAV with respect to _B_ frame, defined

as





(6)




**J** =



_J_ _xx_ 0 0

 0 _J_ _yy_ 0

 0 0 _J_ _zz_



and _τ_ _rotor_ is the torque caused by propeller’s gyroscopic
effects defined according to [23] as



 with Ω _r_ =



_**τ**_ _**rotor**_ = _J_ _r_ Ω _r_



_ω_ _y_

 _ω_ _x_


0




6
� _n_ _i_ _−_ 6 _ω_ _z_ (7)


_i_ =1



where _J_ _r_ is the propeller’s moment of inertia around its axis
of rotation.

_f) Discretized Model:_ Given the sampling time _T_ _s_ =
0 _._ 01s, we discretize the analytic models (3) and (5) using
the forward Euler method, while the normalized attitude
quaternion _**q**_ _k_ is integrated using the approach proposed in

[16]:
_**q**_ _k_ +1 = **Ω** ( _**ω**_ _k_ ) _**q**_ _k_ (8)


with



**Ω** ( _**ω**_ _k_ ) = cos( 21
�



2 _[||]_ _**[ω]**_ _[k]_ _[||][T]_ _[s]_ [)] **[I]** [3] _[×]_ [3] **Ψ** _k_
_−_ **Ψ** _[T]_ _k_ cos( [1] 2 _[||]_ _**[ω]**_



(9)
�



2 _[||]_ _**[ω]**_ _[k]_ _[||][T]_ _[s]_ [)]



and
**Ψ** _k_ = sin ( [1] (10)

2 _[||]_ _**[ω]**_ _**[k]**_ _[||][T]_ _[s]_ [)] _**[ω]**_ _**[k]**_ _[/][||]_ _**[ω]**_ _**[k]**_ _[||]_


The discretized dynamic equations can then be written in
compact form as:


_**s**_ _k_ +1 = _f_ ( _**s**_ _k_ _,_ _**F**_ _[ext]_ _k_ _[, τ]_ _k_ _[ ext]_ _,_ _**n**_ _k_ ) (11)


with
_**s**_ _k_ = � _**p**_ _k_ _**v**_ _k_ _**q**_ _k_ _**ω**_ _k_ � (12)


As the last step we introduce the notation:


_**s**_ _k_ +1 = _f_ _k_ ( _**s**_ _k_ _,_ _**F**_ _[ext]_ _k_ _[, τ]_ _k_ _[ ext]_ ) (13)


where the dependency of _f_ ( _·_ ) from _**n**_ _k_ is taken into account
by making _f_ ( _·_ ) time-variant.


_B. Process and Measurement models_


_g) Process Model:_ First, we augment the state vector of
the hexacopter model (12) and the system dynamic equation
(13) so that they take into account the external force and
torque. We obtain:


_**s**_ _k_ +1 = _f_ _k_ ( _**s**_ _k_ ) + ¯ _**w**_ _k_ (14)


_**s**_ _k_ = � _**p**_ _k_ _**v**_ _k_ _**q**_ _k_ _**ω**_ _k_ _**F**_ _[ext]_ _k_ _τ_ _k_ _[ext]_ � (15)


t



_j) Kalman Filter Based Update Step:_ Because the measurement model corresponds to a linear function, we can use
the standard KF update step for all the states in the vector
state ¯ _**s**_ _k_ .

First, compute the Kalman gain matrix as


_**K**_ _k_ = _**P**_ _[−]_ _k_ _**[H]**_ _[T]_ [ (] _**[HP]**_ _[ −]_ _k_ _**[H]**_ _[T]_ [ +] _**[ R]**_ [)] _[−]_ [1] (22)


Then, the updated state covariance is obtained from


_**P**_ [+] _k_ [= (] **[I]** [16] _[×]_ [16] _[ −]_ _**[K]**_ _[k]_ _**[H]**_ [)] _**[P]**_ _[ −]_ _k_ [(] **[I]** [16] _[×]_ [16] _[ −]_ _**[K]**_ _[k]_ _**[H]**_ [)] _[T]_ [ +] _**[ K]**_ _[k]_ _**[RK]**_ _k_ _[T]_
(23)
Finally, the updated state is obtained from


_**s**_ ¯ [+] _k_ [= ¯] _**[s]**_ _[−]_ _k_ [+] _**[ K]**_ _[k]_ [(] _**[z]**_ _[k]_ _[ −]_ _**[H][s]**_ [¯] _[−]_ _k_ [)] (24)


_D. Quaternion Based Attitude Estimation_


Quaternions do not naturally fit in the Unscented Transformation (UT) since they are defined on a non linear manifold,
while the UT is performed on a vector space. Interpreting a
quaternion as a member of R [4] produces a singular 4 _×_ 4
covariance matrix and does not guarantee the unitary norm
constraint, while considering quaternions as members of R [3]

- by exploiting the unitary norm constraint - always produces
a singularity. For these reasons we estimate the MAV attitude by following the approach called USQUE - Unscented
Quaternion Estimation - proposed by [16]. In this approach,
the attitude estimate is based on the estimation of the error

attitude quaternion - which is always assumed to be smaller
than 180 degrees - through a three states parametrization
obtained using the Modified Rodriguez Parameters (MRP).
**Modified Rodriguez Parameters** Let _**q**_ = [ _**q**_ _[T]_ _v_ _[, q]_ _[s]_ []][ be a]
quaternion, where _**q**_ **v** is the vector part and _q_ _s_ is the scalar
part. A corresponding (but singular) attitude representation
**p**, with **p** _∈_ R [3], can be obtained as


_**q**_ **v**
**p** = _f_ (25)
_a_ + _q_ _s_


where _a_ is a parameter from 0 to 1 and f is a scale factor. We
will choose _f_ = 2( _a_ + 1) and _a_ to be a tunable parameter
of the filter. The inverse representation is obtained as



Desired
trajectory



Reference
Trajectory:


output of the

Admittance

Controller


x(t)



Estimated


External


Forces
Torques


|Col1|Refe<br>Traje<br>outpu<br>Admi<br>Cont|
|---|---|
|||




_[||]_ **[p]** _[||]_ [2] [ +] _[f]_ ~~�~~
_q_ _s_ = _[−][a]_



_f_ [2] + (1 _−_ _a_ [2] ) _||_ **p** _||_ [2]



_f_ [2] + _||_ **p** _||_ [2]



_f_ [2] + _||_ **p** _||_ [2] (26)

_**q**_ **v** = _f_ _[−]_ [1] ( _a_ + _q_ _s_ ) **p**



Fig. 4: Schematic explanation of admittance control. Given
a desired trajectory, the admittance controller generates a
new reference trajectory according to the estimated external
forces by simulating a second order _spring-mass-damper_
dynamic system.


_k) Update Step:_


_•_ Given an attitude measurement _**q**_ _[m]_ _k_ [, compute the rota-]
tion error between ˆ _**q**_ [+] _k−_ 1 [and] _**[ q]**_ _[m]_ _k_ [(27).]


_δ_ _**q**_ _[m]_ _k_ [= ˆ] _**[q]**_ [+] _k−_ 1 _[⊗]_ [(] _**[q]**_ _k_ _[m]_ [)] _[−]_ [1] (27)


_•_ Transform the measured rotation error quaternion _δ_ _**q**_ _[m]_ _k_
in the vector _**e**_ _[m]_ _k_ [using MRP (25).]

_•_ Store _**e**_ _[m]_ _k_ [in][ ¯ˆ] _**[s]**_ _[−]_ _k_ [and compute the updated attitude error]
mean and covariance as in IV-C.0.j.

_•_ Retrieve ˆ _**e**_ [+] _k_ [from][ ¯ˆ] _**[s]**_ [+] _k_ [and compute the updated error]
attitude quaternion _δ_ _**q**_ [+] _k_ [from][ ˆ] _**[e]**_ _k_ [+] [using MRP (26).]

_•_ Rotate the predicted attitude quaternion ˆ _**q**_ _[−]_ _k_ [of] _[ δ]_ _**[q]**_ [+] _k_ [to]
obtain the current quaternion estimate of the attitude


_**q**_ ˆ [+] _k_ [= ˆ] _**[q]**_ _[−]_ _k_ _[⊗]_ _[δ]_ _**[q]**_ [+] _k_ (28)


V. ADMITTANCE CONTROLLER


_A. An Intuitive Explanation_


Admittance control is based on the idea that the trajectory which guarantees compliance with external force/torque
is generated by simulating a _spring-mass-damper_ dynamic
system. As represented in Figure 4, the new trajectory
is generated as if the MAV, with virtual mass _m_ _v_, was
connected to the desired trajectory via a spring with elastic
constant _K_ and via a damper with damping coefficient _c_ .
The deviation from the desired trajectory is caused by the
estimated external force/torque, which excites the virtual

mass.

Compliance with external force/torque can be tuned by
changing _K_ . Increasing values of _K_ simulate a stiffer spring,
which in turn yields to better desired trajectory tracking.
Conversely, _K_ = 0 guarantees full compliance with the
estimated external force.



The implemented algorithm for attitude estimation is discussed in the following steps. Its prediction step follows the
USQUE approach explained in [16]. The update step - where
we fuse the attitude measurement at time _k_ into the attitude

error vector - assumes that the measurement for the filter
corresponds to the difference between the measured attitude
quaternion and the estimate of the attitude at time step _k_ _−_ 1.
Because the initialization and prediction step are extensively
covered in [16] and [26], we only report the implemented
measurement update step.


_B. Trajectory Generation Law_


The Admittance Controller generates a new reference
trajectory independently for every axis. The trajectory generation law has been derived by the discretization of the
differential equation 29 for the generation of the trajectory
on _x_ _I_, _y_ _I_, _z_ _I_ and 30 for the reference value of _ψ_ .


_m_ _v_ (Λ [¨] _d,i_ _−_ Λ [¨] _r,i_ ) + _c_ ( Λ [˙] _d,i_ _−_ Λ [˙] _r,i_ ) + _K_ (Λ _d,i_ _−_ Λ _r,i_ ) = _F_ _i_ _[ext]_ (29)


_J_ _v_ (Λ [¨] _d_ _−_ Λ [¨] _r_ ) + _c_ ( Λ [˙] _d_ _−_ Λ [˙] _r_ ) + _K_ (Λ _d_ _−_ Λ _r_ ) = _τ_ _z_ _[ext]_ (30)


The index _i_ denotes one of the axes _x_ _I_, _y_ _I_, _z_ _I_, while
Λ _d,i_ represents the desired trajectory on the selected axis
and Λ _r,i_ the generated reference trajectory on the selected
axis. The parameters _m_ _v_, _c_ and _K_ can be set independently
for every axis and represent, respectively, the virtual spring,
the virtual damping and the virtual mass of the controller. _J_ _v_
represents virtual inertia around the body _z_ axis. In addition,
the controller only takes into account the desired pose by
setting **Λ** [¨] _d_ = **Λ** [˙] _d_ = 0, which is equivalent to assuming that
the reference is only given in discrete steps. Additionally,
in the output trajectory, we set **Λ** [¨] _r_ = **Λ** [˙] _r_ = 0 so that the
controller only generates a reference for the pose of the
MAV.


_C. Robustness to Noise and Offsets_


If no force acts on the vehicle and the desired trajectory
is constant, noise and other factors not included in the
model (such as propeller efficiency) may result in a non-zero
force estimate, which in turn causes a drift in the reference
pose **Λ** _r_ .Similarly, external factors such as constant wind
or model-mismatches in the force and torque estimator may
cause a constant offset in the estimated external disturbances.

In order to avoid undesired drifts in the reference tra
jectory, the admittance controller has been integrated into
a finite state machine (FSM), which monitors the magnitude
of the force on each axis and decides whether to reject or
take into account the estimated external force to compute a
new trajectory reference [14]. Model mismatches and offset
in the force/torque estimation can be taken into account by
averaging the estimated external forces for a given time _T_ _avg_
while the helicopter is hovering. The computed offset is
subtracted from each force/torque estimate produced by the
force/torque estimator.


_D. Landing Detection and Auto-Disengagement_


The controller must be engaged only once the vehicle is
hovering, so that it does not take into account the ground
reaction force as an external force resulting in an undesired
reference trajectory as the output. The controller is also able
to auto-disengage by detecting landing. Landing detection is
achieved by checking the magnitude of the estimated external
force and its angle _θ_ _L_ with respect to the normal of the plane
_x_ _I_, _y_ _I_ ; landing is detected when the magnitude of _**F**_ _[ext]_ is
bigger than a tunable threshold _**F**_ [¯] _ext_ and if _θ_ _L_ is smaller
than a tunable threshold _θ_ [¯] _L_ for a given time _T_ _Landing_ .



2


1


0


-1


-2


2


0


-2


-4


0


-2


-4


-6





0 5 10 15 20
Time - t [s]





0 5 10 15 20
Time - t [s]





0 5 10 15 20
Time - t [s]


Fig. 5: Measured forces and estimated forces on _x_ _I_, _y_ _I_ and
_z_ _I_ axis. We performed the experiment with the hexacopter
on hover and using the visual inertial navigation system as
state estimator.


TABLE I: RMS estimation error for force/torque estimator
validation


Disturbance RMS error Unit
_F_ _x_ ~~_[ext]_~~ 0 _._ 4298 N
_F_ _[ext]_ 0 _._ 4941 N
_y_
_F_ _z_ _[ext]_ 0 _._ 5729 N


VI. EVALUATION


We now present four main experimental results. In the first
two, we benchmark the performances of the force/torque estimator by comparing its estimates with the measurements of
a force sensor and by showing its reaction speed in detecting
a collision with a wall, respectively. In the third experiment,
we test the admittance controller by interacting with the
vehicle through a rope and finally, in the fourth experiment,
we show the result of a payload carrying maneuver using
two hexacopters.


_A. Force and torque estimator accuracy_


The first experiment was performed by connecting a Optoforce OMD-20-FE-200N force sensor at the bottom of the

structure of the AscTech Firefly. An in-extensible nylon wire
was attached to the sensor and interaction was performed
by pulling the wire, while the MAV was maintained steady
at about 1 _._ 6 m from the ground by the VI-odometry state
estimator and MPC pose and attitude controller. The external
forces due to the interaction measured and estimated on the

_x_ _I_ and _y_ _I_ axis are represented in Figure 5. The RMS error
between the measurements and the estimate is reported in
Table I.


_B. Detecting Collision with a Wall_


In this experiment we use the force estimator to detect a
collision with a wall and to send a ”safe” new reference to

the position and attitude controller. We use this experiment to


0


-1


-2


-3


-4





0 1 2 3 4 5 6 7 8
Time - t [s]


40


30


20


10


0


-10

0 1 2 3 4 5 6 7 8
Time - t [s]


Fig. 6: Wall collision detection experimental results. The wall
is placed at _y_ _I_ = _−_ 1 _._ 95 m. The impact generates an external
force of 34 _._ 5 N and a safe trajectory reference is generated
0.84 m further than the impact point. The impact happens at
about 1 _._ 2 m/s.



0



Fig. 8: Illustration of the human-hexacopter interaction. The
interaction is performed through a string attached at the
bottom of the MAV. It is possible to experiment with
different values of virtual spring, mass and damping to
understand how they affect the behavior of the slave agent
in a collaborative transportation task.


0.5





1.2

0.8

0.4

0

-0.4

-0.8

-1.2

-1.6

-2



35


20


5


-10


-25


-40


-55



3.8 3.85 3.9 3.95 4 4.05
Time - t[s]


Fig. 7: Detail of the impact detection time computation. The
vertical line on the left represents the impact instant _t_ =
3 _._ 870 s, while the vertical line on the right the detection
instant _t_ = 3 _._ 887 s.


highlight the reaction speed of the force estimator, showing
that it is able to react in less than 20 ms.

The logic for the trajectory modification is simply based
on checking if the estimated external force exceeds a given
threshold. If yes, than a safe reference is generated, which
is computed by translating the impact point by a vector
proportional to the impact force magnitude - computed at
the step after the impact - and direction.

In Figure 6 we represent how the filter and the ”safety”
controller react in case of impact with a wall. Since the
wall corresponds to the plane _y_ _I_ = _−_ 1 _._ 95 m expressed
in _I_ reference frame, we only show the _y_ component of
(a) desired trajectory, (b) trajectory generated by safety
controller, (c) pose of the MAV, estimated using a motion
capture system [17], and (d) estimated external force.


_C. Drone on a Leash_


To test the capability of admittance controller we present a
real-time interaction. A human operator can interact with the
MAV via a string attached at the bottom of the hexacopter.
The results are represented in Figure 8.



-0.5


-1


-1.5


-2


-2.5


-3

-1.5 -1 -0.5 0 0.5 1 1.5
Position x - [m]


Fig. 9: Executed trajectory by the slave agent. The estimated
external forces acting on the slave agent is depicted by the
black arrows.


_D. Cooperative payload transportation_


Finally we present the cooperative transportation of a
bulky object. The payload is a 1 _._ 2 m carton tube weighing
0 _,_ 37 kg. The helicopters are two identical AscTec Firefly
systems and the state estimator used is the visual-intertial
navigation system (VI sensor). The master helicopter is
controlled by a human operator, while the trajectory for the
slave vehicle is generated by the admittance controller. Both
the helicopters are attached at the extremities of the payload
via a nylon wire, which cancels any torque. The admittance
controller is used to generate a compliant trajectory on the
_x_ _I_ and _y_ _I_ axis, while tracking a given altitude reference on
_z_ _I_ . We achieved this by setting the virtual spring value on _x_
and _y_ axis to be _K_ = 0 N/m, while on the _z_ a stiff virtual
spring of value _K_ = 10 N/m has been used.
The setup of the experiment is represented in Figure 1.
The reference trajectory for the slave and its position are
represented in Figure 9, while the reference trajectory and
the estimated external forces for every axis are shown in
Figure 10. Finally, the estimated external torque as well as


2


0


-2


-4


-6





0 5 10 15 20 25
time [s]



6


4


2


0


-2


-4





0 5 10 15 20 25
time [s]



1


0


-1


-2


-3





0 5 10 15 20 25
time [s]


Fig. 10: Estimated external force, admittance controller reference trajectory and estimated position of the slave agent
during the collaborative transportation.



0.3


0.2


0.1





0


-0.1


-0.2


-0.3


-0.4


-0.5


-0.6


-0.7

0 5 10 15 20
Time - t [s]


Fig. 11: Estimated external torque around _z_ axis, reference
trajectory for yaw attitude angle, and estimated yaw attitude
angle (VI-sensor). The peak in torque estimation at _t_ =
22 s corresponds to the accidental collision of one of the
propellers of the MAV with the payload.


the yaw angle are displayed in Figure 11.


VII. CONCLUSION


In this work we showed that collaborative transportation
of bulky payload can be achieved without relying on a
communication network between the involved agents. We
achieved this by making use of an admittance controller in
conjunction with a force estimator based on the Unscented
Kalman Filter. The force estimates are obtained using the
state information provided by a visual inertial navigation
system. We include demonstration of the filter performance
by detecting wall collision and real time interaction with a
human.


R EFERENCES


[1] 2016. [Online]. Available: [http://www.io.tudelft.nl/onderzoek/](http://www.io.tudelft.nl/onderzoek/delft-design-labs/applied-labs/ambulance-drone/)
[delft-design-labs/applied-labs/ambulance-drone/](http://www.io.tudelft.nl/onderzoek/delft-design-labs/applied-labs/ambulance-drone/)

[[2] “Zipline, the future of healthcare is out for delivery, website,” http:](http://flyzipline.com)
[//flyzipline.com, 2016.](http://flyzipline.com)




[3] M. Nieuwenhuisen, D. Droeschel, M. Beul, and S. Behnke, “Autonomous MAV Navigation in Complex GNSS-denied 3D Environments,” _IEEE International Symposium on Safety, Security, and Rescue_
_Robotics (SSRR)_, no. October, pp. 1241–1250, 2015.

[4] F. A. Architecture, “Architecture Installation,” no. August, 2014.

[5] I. Maza, K. Kondak, M. Bernard, and A. Ollero, “Multi-UAV cooperation and control for load transportation and deployment,” _Journal_
_of Intelligent and Robotic Systems: Theory and Applications_, vol. 57,
no. 1-4, pp. 417–449, 2010.

[6] N. Michael, J. Fink, and V. Kumar, “Cooperative manipulation and
transportation with aerial robots,” _Autonomous Robots_, no. September
2010, pp. 1–14, 2010.

[7] D. Mellinger, M. Shomin, N. Michael, and V. Kumar, “Cooperative Grasping and Transport using Multiple QuadrotorsmellingerDARS10.pdf,” pp. 1–14, 2015.

[8] H. F. McCreery and M. D. Breed, “Cooperative transport in ants: A
review of proximate mechanisms,” _Insectes Sociaux_, vol. 61, no. 2,
pp. 99–110, 2014.

[9] H. N. Nguyen, S. Park, and D. Lee, “Aerial tool operation system
using quadrotors as Rotating Thrust Generators,” _IEEE International_
_Conference on Intelligent Robots and Systems_, vol. 2015-Decem, pp.
1285–1291, 2015.

[10] P. J. S. D. Mittal, M., “Nonlinear adaptive control of a twin lift
helicopter system,” _IEEE Control Systems Magazine 11(3)_, pp. 39–
45, 1991.

[11] R. A. Reynolds, H.K., “H control of a twin lift helicopter system,”
_Proceedings of the 31st IEEE Conference on Decision and Control_,
pp. 2442–2447, 1992.

[12] V. Parra-Vega, A. Sanchez, C. Izaguirre, O. Garcia, and F. RuizSanchez, “Toward aerial grasping and manipulation with multiple
UAVs,” _Journal of Intelligent and Robotic Systems: Theory and_
_Applications_, vol. 70, no. 1-4, pp. 575–593, 2013.

[13] L. Villani and J. D. Schutter, _Springer Handbook of Robotics, B._
_Siciliano and O. Khatib_, E. B. H. Springer-Verlag, Ed., 2008.

[14] F. Augugliaro and R. D’Andrea, “Admittance control for physical
human-quadrocopter interaction,” _Control Conference (ECC), 2013_
_. . ._, pp. 1805–1810, 2013.

[15] C. D. Mckinnon and A. P. Schoellig, “Unscented External Force
Estimation for Quadrotors and Experiments,” _arXiv_, 2016.

[16] J. Crassidis and F. L. Markley, “Unscented Filtering for Spacecraft
Attitude Estimation,” _Journal of Guidance, Control, and Dynamics_,
vol. 26, no. 4, pp. 536–542, 2003.

[[17] “Vicon website,” http://www.vicon.com, 2016.](http://www.vicon.com)

[18] J. Nikolic, J., R. M. Burri, P. Gohl, S. Leutenegger, P. Furgale, and
R. Siegwart, “A Synchronized Visual-Inertial Sensor System with
_{_ FPGA _}_ Pre-Processing for Accurate Real-Time _{_ SLAM _}_,” _{IEEE}_
_Int. Conf. on Robotics and Automation (ICRA)_, 2014.

[19] M. Kamel, T. Stastny, K. Alexis, and R. Siegwart, “Model predictive
control for trajectory tracking of unmanned aerial vehicles using robot
operating system,” in _Robot Operating System (ROS) The Complete_
_Reference_, A. Koubaa, Ed. Springer, (to appear).

[20] M. Kamel, M. Burri, and R. Siegwart, “Linear vs Nonlinear MPC for
Trajectory Tracking Applied to Rotary Wing Micro Aerial Vehicles,”
_ArXiv e-prints_, Nov. 2016.

[21] M. W. Achtelik, S. Lynen, M. Chli, and R. Siegwart, “Inversion
based direct position control and trajectory following for micro aerial
vehicles,” _IEEE International Conference on Intelligent Robots and_
_Systems_, pp. 2933–2939, 2013.

[[22] “Ascending technologies website,” http://www.asctec.de, 2016.](http://www.asctec.de)

[23] S. Bouabdallah, “Design and Control of Quadrotors With Application
To Autonomous Flying,” _Ecole Polytechnique F´ed´erale De Lausanne,_ _[´]_
_`A La Facult´e Des Sciences Et Techniques De L’Ing´enieur_, vol. 3727,
no. 3727, p. 61, 2007.

[24] D. Simon, _Optimal State Estimation_, 2006, vol. 2. [Online]. Available:
[http://www.ncbi.nlm.nih.gov/pubmed/19274326](http://www.ncbi.nlm.nih.gov/pubmed/19274326)

[25] S. J. Julier and J. K. Uhlmann, “A General Method for Approximating
Nonlinear Transformations of Probability Distributions,” pp. 1–27,
1996.

[26] F. L. Markley, Y. Cheng, J. L. Crassidis, and Y. Oshman, “Quaternion
Averaging,” _NASA Goddard Space Flight Center_, pp. 1–10, 2007.


