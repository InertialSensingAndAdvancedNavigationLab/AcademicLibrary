## **Equivariant Filter Design for Inertial Navigation Systems with Input** **Measurement Biases**

Alessandro Fornasier [1], Yonhon Ng [2], Robert Mahony [2] and Stephan Weiss [1]



_**Abstract**_ **—Inertial Navigation Systems (INS) are a key tech-**
**nology for autonomous vehicles applications. Recent advances in**
**estimation and filter design for the INS problem have exploited**
**geometry and symmetry to overcome limitations of the classical**
**Extended Kalman Filter (EKF) approach that formed the main-**
**stay of INS systems since the mid-twentieth century. The industry**
**standard INS filter, the Multiplicative Extended Kalman Filter**
**(MEKF), uses a geometric construction for attitude estimation**
**coupled with classical Euclidean construction for position, veloc-**
**ity and bias estimation. The recent Invariant Extended Kalman**
**Filter (IEKF) provides a geometric framework for the full naviga-**
**tion states, integrating attitude, position and velocity, but still uses**
**the classical Euclidean construction to model the bias states. In**
**this paper, we use the recently proposed Equivariant Filter (EqF)**
**framework to derive a novel observer for biased inertial-based**
**navigation in a fully geometric framework. The introduction of**
**virtual velocity inputs with associated virtual bias leads to a full**
**equivariant symmetry on the augmented system. The resulting**
**filter performance is evaluated with both simulated and real-**
**world data, and demonstrates increased robustness to a wide**
**range of erroneous initial conditions, and improved accuracy**
**when compared with the industry standard Multiplicative EKF**
**(MEKF) approach.**


I. I NTRODUCTION


State observers for mobile systems are core components in
enabling autonomous robotic applications. Classical solutions
including Extended Kalman Filter (EKF), Unscented Kalman
Filter (UKF), and non-linear optimization methods demonstrated their relevance in practical application. However, despite their success, they are known to lack in robustness due to
their local coordinate representation and linearization issues. In
fact, the mathematical proof of their (guaranteed) convergence
has only been shown under several strong assumptions [1] [2].
This has motivated the study of geometric observers that exploit symmetry and geometric properties of systems on homogeneous spaces and Lie groups to deliver better robustness and
performance. Geometric nonlinear observers for navigation
problem and pose estimation on **SE** (3) have been derived in
deterministic form [3], and stochastic form [4] [5]. However,
most of these observers are designed for first order kinematic
systems where a velocity input is available. Motivated by the
widespread use of robotic systems carrying a low-cost Inertial
Measurement Unit (IMU), and with particular focus on the


1 Alessandro Fornasier and Stephan Weiss are with the Control
of Networked Systems Group, University of Klagenfurt, Austria.
{alessandro.fornasier,stephan.weiss}@ieee.org
2 Yonhon Ng and Robert Mahony are with the System Theory
and Robotics Lab, Australian National University, Australia.
{yonhon.ng,robert.mahony}@anu.edu.au
This work is supported by the EU-H2020 project BUGWRIGHT2 (GA
871260)
**Accepted January/2022 for ICRA 2022, DOI follows ASAP ©IEEE.**



non-biased inertial navigation problem, nonlinear geometric
deterministic [6] [7] and stochastic [8] observers for second
order kinematic systems have been considered. Different from
these approaches, Barrau and Bonnabel [2] proposed the
Invariant Extended Kalman Filter (IEKF), a geometric EKFlike observer for kinematic systems posed on a matrix Lie
group with invariance properties. Reduced linearisation error
and local convergence properties are key features that make
the IEKF an excellent choice for a broad class of (group affine)
systems on matrix Lie groups.
Asymptotically stable observers for kinematic systems on
homogeneous spaces or Lie groups require measurements of
the system input. In practice, such measurements are typically
corrupted by constant or slowly time-varying unknown biases.
The problem of observer design for concurrent estimation
of the system state and input measurement biases has been
tackled by different authors with different methodologies, including; non-linear deterministic observers [9] [10], gradientbased observers [11] and IEKF observers [12] [13]. Common
to all prior approaches, however, is that the inclusion of the
bias state in the estimation breaks the symmetry and leads to
complete or partial loss of the key properties such observers
are characterized by.
In this paper, we tackle the problem of designing an Equivariant Filter (EqF) for the biased inertial navigation system.
Such a system is neither invariant nor group affine, and thus
IEKF observers cannot be directly applied without loss of
the log-linear property [12] [13]. Motivated by the recent
research in the new field of equivarariant system theory [14]
and EqF design [15] we use velocity extension and equivariant
filter design methodologies to obtain a fully geometric EKFlike filter for a navigation system including bias states. Key
contributions of the paper are: First, the exploitation of the
semi-direct product structure to define the symmetry group
**SE** 2 (3) ⋉ se 2 (3), and the subsequent modeling of the biased
inertial navigation system as equivariant system. Second, the
presentation of a novel equivariant lift for the system onto the
symmetry group leading to the proposed design of an Equivariant Filter for the lifted system. To the best of our knowledge,
this is the first work presenting a geometric EKF-like observer
for the concurrent estimation of the navigation state and the
input measurement biases characterized by a tightly-coupled
geometric description of such states. The performance of the
proposed EqF is demonstrated on simulations and real-world
in-flight data of an Unmanned Aerial Vehicle (UAV) equipped
with an IMU and able to receive extended pose measurements
of position, attitude and velocity. A performance gain of 30%40% in terms of input measurement bias estimation, as well


as, enhanced stability and robustness compared to the industry
standard MEKF, make the proposed EqF a suitable choice
to replace other EKF-like observer for robotic navigation
problem. Practical use cases of the proposed EqF could include
an aircraft equipped with multiple GNSS receivers able to
obtain direct position and velocity measurements, and indirect
attitude measurements given a sufficient baseline among the
different receivers [16], or an aircraft equipped with a single
GNSS receiver that provides position and velocity measurements and a magnetometer to provide attitude information.


II. P RELIMINARIES

Let _ξ_ ∈M be an element of a smooth manifold M, TM
denotes the tangent bundle, T _ξ_ M denotes the tangent space of
M at _ξ_ and X (M) denotes the set of all smooth vector fields
on M. A Lie group **G** is a smooth manifold endowed with
a smooth group multiplication that satisfies the group axioms.
For any _X,Y_ ∈ **G**, the group multiplication is denoted _XY_,
the group inverse _X_ [−][1] and the identity element _I_ . In this work
we will focus our attention on a special case of Lie groups,
called matrix Lie groups, which are those whose elements are
invertible square matrices and where the group operation is the
matrix multiplication. For a given Lie group **G**, the Lie algebra
g is a vector space corresponding to T _I_ **G**, together with a
bilinear non-associative map [⋅ _,_ ⋅] ∶ g → g called Lie bracket.
The Lie algebra g is isomorphic with a vector space R _[n]_ of
the same dimension _n_ = dim (g). We define the wedge map
(⋅) [∧] ∶ R _[n]_ → g and its inverse, the vee map (⋅) [∨] ∶ g → R _[n]_,
as mappings between the vector space and the Lie algebra.
For any _X,Y_ ∈ **G**, the left and right translation by _X_ write


_L_ _X_ ∶ **G** → **G** _,_ _L_ _X_ ( _Y_ ) = _XY,_


_R_ _X_ ∶ **G** → **G** _,_ _R_ _X_ ( _Y_ ) = _Y X,_

follows that for _η_ _Y_ ∈ T _Y_ **G**, their differential are defined by


d _L_ _X_ ∶ T _Y_ **G** → T _XY_ **G** _,_ d _L_ _X_ [ _η_ _Y_ ] = _Xη_ _Y_ _,_


d _R_ _X_ ∶ T _Y_ **G** → T _Y X_ **G** _,_ d _R_ _X_ [ _η_ _Y_ ] = _η_ _Y_ _X._


Proofs are provided in the supplementary material [17].
The Adjoint map for **G**, Ad _X_ ∶ g → g is defined by


Ad _X_ [ _**u**_ [∧] ] = d _L_ _X_ d _R_ _X_ −1 [ _**u**_ [∧] ] _,_


for every _X_ ∈ **G** and _**u**_ [∧] ∈ g. In the context of matrix Lie
group, we can define the Adjoint matrix to be the map
**Ad** [∨] _X_ [∶] [R] _[n]_ [ →] [R] _[n]_ [ defined by]


∨
**Ad** [∨] _X_ _**[u]**_ [ = (][Ad] _[X]_ [[] _**[u]**_ [∧] [])] _._


In addition to the Adjoint map for the group **G**, the adjoint
map for the Lie algebra g can be defined as the differential at
the identity of the Adjoint map for the group **G**, therefore the
adjoint map for the Lie algebra ad _**u**_ ∧ ∶ g → g is written


ad _**u**_ ∧ [ _**v**_ [∧] ] = _**u**_ [∧] _**v**_ [∧] − _**v**_ [∧] _**u**_ [∧] = [ _**u**_ [∧] _,_ _**v**_ [∧] ] _,_


that is equivalent to the Lie bracket. Again, in the context of
matrix Lie group we can define the adjoint matrix **ad** [∨] _**u**_ [∧] ∶
R _[n]_ → R _[n]_ as


∨ ∧ ∧ ∨
**ad** [∨] _**u**_ [∧] _**[v]**_ [ = (] _**[u]**_ [∧] _**[v]**_ [∧] [−] _**[v]**_ [∧] _**[u]**_ [∧] [)] = [ _**u**_ _,_ _**v**_ ] _._



The Adjoint operator is a Lie-algebra automorphism


Ad _X_ [ad _**u**_ ∧ [ _**v**_ [∧] ]] = ad (Ad _X_ [ _**u**_ ∧ ]) [Ad _X_ [ _**v**_ [∧] ]] _._


A right group action of a Lie group **G** on a differentiable
manifold M is a smooth map _φ_ ∶ **G** × M →M that satisfies
_φ_ ( _I,ξ_ ) = _ξ_ and _φ_ ( _X,φ_ ( _Y,ξ_ )) = _φ_ ( _Y X,ξ_ ) for any _X,Y_ ∈ **G**
and _ξ_ ∈M. A right group action _φ_ induces a family of diffeomorphisms _φ_ _X_ ∶M →M and smooth nonlinear projections
_φ_ _ξ_ ∶ **G** →M. The group action _φ_ is said to be transitive if
the induced projection _φ_ _ξ_ is surjective, and, in such case, M
is termed homogeneous space. A right group action _φ_ induces
a right group action on X (M), Φ ∶ **G** × X (M) → X (M)
defined by the push forward [18] such that


Φ ( _X,f_ ) = d _φ_ _X_ _f_      - _φ_ _X_ −1 _,_


for each _f_ ∈ X (M), _φ_ -invariant vector field and _X_ ∈ **G** .


III. B IASED I NERTIAL N AVIGATION S YSTEM


This work considers the problem of estimating the extended
pose [12] of a rigid body, together with the accelerometer
and gyroscope biases that affect the IMU measurements.
Therefore estimating the state of what we called biased inertial
navigation system. Let { _G_ } denote the global inertial frame of
reference and { _I_ } denote the IMU frame, which is assumed to
coincide with the rigid body’s center of mass. In non-rotating,
flat earth assumption the (noise-free) system is written



_GI_ ˙ **[R]** [ =] _[ G]_ _I_ **[R]** [(] _[I]_ _**[ω]**_ [ −] _[I]_ _**[b]**_ _**[ω]**_ [)] ∧ _,_ (1a)
_G_ **p** ˙ _I_ = _G_ _**v**_ _I_ _,_ (1b)
_G_ _**v**_ ˙ _I_ = _GI_ **[R]** [(] _[I]_ _**[a]**_ [ −] _[I]_ _**[b]**_ _**[a]**_ [) +] _[ G]_ _**[g]**_ (1c)



_I_ _**b**_ ˙ _**ω**_ = **0** _,_ (1d)

_I_ ˙
_**b**_ _**a**_ = **0** _._ (1e)



Here _[G]_ _I_ **[R]** [ corresponds to the rigid body orientation and it is]
defined by a rotation matrix that rotates a vector _[I]_ _**x**_ defined
in the { _I_ } frame to a vector _[G]_ _**x**_ = _[G]_ _I_ **[R]** _[ I]_ _**[x]**_ [ defined in the]
{ _G_ } frame. The rigid body position and velocity expressed
in the { _G_ } frame are denoted _[G]_ _**p**_ _I_ and _[G]_ _**v**_ _I_ respectively.
The gravity vector in the { _G_ } frame is denoted _[G]_ _**g**_ . The
body-fixed, biased, angular velocity and linear acceleration
measurements provided by an IMU are denoted _[I]_ _**ω**_ and _[I]_ _**a**_ .
The gyroscope and accelerometer biases are denoted _[I]_ _**b**_ _**ω**_ and
_I_ _**b**_ _**a**_ respectively.
In order to exploit the geometrical properties of the system, let _ν,τ_ _ω_, _τ_ _ν_, _τ_ _a_ be, in general, virtual, non-physical
inputs and _I_ _**b**_ _**ν**_ be an additional velocity-bias state variable. Then the system kinematics can be extended as



_GI_ ˙ **[R]** [ =] _[ G]_ _I_ **[R]** [(] _[I]_ _**[ω]**_ [ −] _[I]_ _**[b]**_ _**[ω]**_ [)] ∧ _,_ (2a)
_G_ **p** ˙ _I_ = _GI_ **[R]** [(] _[ν]_ [ −] _[I]_ _**[b]**_ _**[ν]**_ [) +] _[ G]_ _**[v]**_ _[I]_ _[,]_ (2b)
_G_ _**v**_ ˙ _I_ = _GI_ **[R]** [(] _[I]_ _**[a]**_ [ −] _[I]_ _**[b]**_ _**[a]**_ [) +] _[ G]_ _**[g]**_ _[,]_ (2c)



_I_ _**b**_ ˙ _**ω**_ = _τ_ _ω_ _,_ (2d)
_I_ _**b**_ ˙ _**ν**_ = _τ_ _ν_ _,_ (2e)

_I_ ˙
_**b**_ _**a**_ = _τ_ _a_ _._ (2f)



Where it is clear that fixing the additional state variable and
virtual inputs to zero lets us retrieve the original kinematics
in Equ. (1). For the sake of clarity we have used bold letters
for state variables and modeled inputs and non-bold letters
without superscripts for virtual, non-physical inputs.


Let _GI_ **[T]** = ( _[G]_ _I_ **[R]** _[,]_ _[ G]_ _**[p]**_ _[I]_ _[,]_ _[ G]_ _**[p]**_ _[I]_ [)] ∈ SE 2 (3) denote platform’s extended pose, and _I_ _**b**_ = ( _I_ _**b**_ _**ω**_ _,_ _I_ _**b**_ _**ν**_ _,_ _I_ _**b**_ _**a**_ ) ∈ R 9 the
modeled measurement biases. Let _**u**_ = ( _[I]_ _**w**_ [∧] _,_ _**g**_ [∧] _,τ_ [∧] ) ∈ L,
L ⊆ se 2 (3) × se 2 (3) × se 2 (3) denote the system input, where
_I_ _**w**_ = ( _I_ _**ω**_ _, ν,_ _I_ _**a**_ ) ∈ R 9 . SE 2 (3) is the **SE** 2 (3)-Torsor [19]
and se 2 (3) the Lie algebra of **SE** 2 (3). The biased inertial
navigation system can then be written as a first order kinematic
system, with state _ξ_ = ( _[G]_ _I_ **[T]** _[,]_ _[ I]_ _**[b]**_ [∧] [)][ posed on the direct product]
manifold M ∶= SE 2 (3) × se 2 (3), as


_G_
_I_ **[T]** [˙] [ =] _[ f]_ 1 [ 0] [(] _[G]_ _I_ **[T]** [)] _[ G]_ _I_ **[T]** [ +] _[ G]_ _I_ **[T]** [(] _[I]_ _**[w]**_ [∧] [−] _[I]_ _**[b]**_ [∧] [) +] _**[ g]**_ [∧] _[G]_ _I_ **[T]** _[,]_ (3)

_I_ ˙ _**b**_ ∧ = _τ_ ∧ _,_ (4)


where _f_ 1 [0] [∶SE] [2] [(][3][) →] [T][SE] [2] [(][3][)][,] _[ f]_ 1 [ 0] [∈] [R] [(SE] [2] [(][3][))][ is a right]
invariant vector field defined by


_G_
_f_ 1 [0] [(] _[G]_ _I_ **[T]** [) ∶= [] **[0]** _**v**_ _I_ **0** (5)
**0** **0** **0** []] _[.]_


Moreover, the biased inertial navigation system kinematics
can also be written in the following compact affine form:

˙
_ξ_ = _f_ [0] ( _ξ_ ) + _f_ _**u**_ ( _ξ_ )

(6)
= _f_ [0] ( _ξ_ ) + ( _[G]_ _I_ **[T]** [(] _[I]_ _**[w]**_ [∧] [−] _[I]_ _**[b]**_ [∧] [) +] _**[ g]**_ [∧] _[G]_ _I_ **[T]** _[, τ]_ [ ∧] [)] _[,]_

with _f_ [0] ( _ξ_ ) ∶= ( _f_ 1 [0] [(] _[G]_ _I_ **[T]** [)] _[ G]_ _I_ **[T]** _[,]_ **[ 0]** [∧] [)][,] _[ f]_ [ 0] [ ∈] [R] [(M)][ a right invari-]
ant vector field, termed drift field.
Along this work, we consider the case where an extended
pose measurement of the rigid body is available to the system.
In such cases the output space can be defined by N ∶= SE 2 (3)
and, thus, the configuration output _h_ ∶M →N is defined by

_h_ ( _ξ_ ) = _[G]_ _I_ **[T]** _[.]_ (7)


Then a real-world measurement with associated Gaussian

noise _**n**_ can be modeled as [20]


_y_ = _[G]_ _I_ **[T]** [exp] [(] _**[n]**_ [∧] [)] or _y_ = exp ( _**n**_ [∧] ) _[G]_ _I_ **[T]** _[.]_ (8)


depending if uncertainties are associated locally or globally.


IV. S YMMETRY OF THE B IASED I NERTIAL N AVIGATION

S YSTEM

Physical systems in robotics usually carry natural symmetries that encodes invariance or equivariance properties of
their dynamical models under space transformations given
by a symmetry group. As already recognized and widely
accepted, symmetric properties of kinematic systems can be
exploited to design high-performance and robust observers. In
particular, as mentioned in the introduction, a key contribution
of this paper is the exploitation of a novel symmetry group
**SE** 2 (3) [⋉] se 2 (3) [=] **[ SE]** [2] [(][3][) ⋉] [se] [2] [(][3][)][ as a semi-direct product of]
**SE** 2 (3) with se 2 (3), which leads to a new formulation of the
biased inertial navigation system as an equivariant kinematic
system. Additional mathematical preliminaries, as well as, extended proofs are available in the supplementary material [17].
For the sake of clarity, in the two following sections we
omit all the superscript and subscript associated with reference
frames from the state variables and input to improve the
readability of the definitions and theorems. Therefore, we
consider _ξ_ = ( **T** _,_ _**b**_ [∧] ) ∈M and _**u**_ = ( _**w**_ [∧] _,_ _**g**_ [∧] _,τ_ [∧] ) ∈ L.



_A. The Semi-direct Product Group_


Let _X_ = ( _A,a_ ) and _Y_ = ( _B,b_ ) be elements
of the symmetry group **SE** 2 (3) [⋉] se 2 (3) [.] The semi-direct
group product is defined by _Y X_ = ( _BA,b_ + Ad _B_ [ _a_ ]).
The inverse element is _X_ [−][1] = ( _A_ [−][1] _,_ −Ad _A_ −1 [ _a_ ]) with
identity element ( _I,_ 0). The inverse of a product is
( _Y X_ ) [−][1] = (( _BA_ ) [−][1] _,_ −Ad ( _BA_ ) −1 [ _b_ + Ad _B_ [ _a_ ]]).


_B. Equivariance of the biased inertial navigation system_

**Lemma 4.1.** _Define φ_ ∶ **SE** 2 (3) [⋉] se 2 (3) [× M →M] _[ as]_


_φ_ ( _X,ξ_ ) ∶= ( **T** _A,_ Ad _A_ −1 [ _**b**_ [∧] − _a_ ]) _._ (9)


_Then, φ is a transitive right group action of_ **SE** 2 (3) [⋉] se 2 (3) _[on]_
M _._


Proof is provided in the supplementary material [17].

**Lemma 4.2.** _Define ψ_ ∶ **SE** 2 (3) [⋉] se 2 (3) [×][ L][ →] [L] _[ as]_


_ψ_ ( _X,_ _**u**_ ) ∶= (Ad _A_ −1 [ _**w**_ [∧] − _a_ ] + _f_ 1 [0] [(] _[A]_ [−][1] [)] _[,]_ _**[ g]**_ [∧] _[,]_ [ Ad] _A_ [−][1] [ [] _[τ]_ [ ∧] [])] _[,]_
(10)


_where f_ 1 [0] [∶] **[SE]** [2] [(][3][) →] [T] **[SE]** [2] [(][3][)] _[ is given by Equ. (5). Then,][ ψ]_
_is a right group action of_ **SE** 2 (3) [⋉] se 2 (3) _[on]_ [ L] _[.]_


Proof is provided in the supplementary material [17].


**Theorem 4.3.** _The biased inertial navigation system in_
_Equ. (6) is equivariant under the actions φ in Equ. (9) and ψ_
_in Equ. (10) of the symmetry group_ **SE** 2 (3) [⋉] se 2 (3) _[. That is]_


_f_ [0] ( _ξ_ ) + _f_ _ψ_ _X_ ( _**u**_ ) ( _ξ_ ) = Φ _X_ _f_ [0] ( _ξ_ ) + Φ _X_ _f_ _**u**_ ( _ξ_ ) _._


Proof is provided in the supplementary material [17].


_Remark_ 4.4 _._ Note that the re-modeling of the biased inertial
navigation system from Equ. (1) to Equ. (2) by adding
additional virtual inputs and state variables is a necessary step
to prove the equivariant property of the system. This is one of
our key contributions that allowed us to find a symmetry of
the biased inertial navigation system for the first time in the
field of biased inertial navigation.


_C. Output equivariance_

**Lemma 4.5.** _Define ρ_ ∶ **SE** 2 (3) [⋉] se 2 (3) [× N →N] _[ as]_


_ρ_ ( _X,y_ ) ∶= _yA._ (11)


_Then, the configuration output defined in Equ. (7) is equivari-_
_ant [15]._


Proof is provided in the supplementary material [17].


V. L IFTED S YSTEM


_A. Equivariant Lift_

In order to design an EqF we need to find a lift of the system
kinematics into the Lie algebra of the symmetry group, that
is a smooth map Λ ∶M × L → se 2 (3) [⋉] se 2 (3) [linear in][ L][ such]
that
_dφ_ _ξ_ ( **I** )[Λ ( _ξ,_ _**u**_ )] = _f_ [0] ( _ξ_ ) + _f_ _**u**_ ( _ξ_ ) _,_


∀ _ξ_ ∈M _,_ _**u**_ ∈ L. For the sake of clarity and due to the
limited space, we split the lift function into two functions
Λ 1 _,_ Λ 2 ∶M × L → se 2 (3).


**Theorem 5.1.** _Define_ Λ 1 ∶M × L → se 2 (3) _as_


Λ 1 ( _ξ,_ _**u**_ ) ∶= ( _**w**_ [∧] − _**b**_ [∧] ) + Ad **T** −1 [ _**g**_ [∧] ] + **T** [−][1] _f_ 1 [0] [(] **[T]** [)] _[.]_ (12)


_And, define_ Λ 2 ∶M × L → se 2 (3) _as_


Λ 2 ( _ξ,_ _**u**_ ) ∶= ad _**b**_ ∧ [Λ 1 ( _ξ,_ _**u**_ )] − _τ_ [∧] _._ (13)


_Then, the map_ Λ ( _ξ,_ _**u**_ ) = (Λ 1 ( _ξ,_ _**u**_ ) _,_ Λ 2 ( _ξ,_ _**u**_ )) _is an equiv-_
_ariant lift for the system in Equ. (6) with respect to the defined_

_symmetry group._


Proof is provided in the supplementary material [17].


_B. Origin_

The lift Λ defined in Equ. (12)-(13) provides the necessary structure that connects the input space with the Lie
algebra of the symmetry group and, therefore, defines a
lifted system on the symmetry group. However, in order
to do so, we need to define a state origin _ξ_ 0 ∈M for a
global coordinate parametrization of the state space M by
the symmetry group **SE** 2 (3) [⋉] se 2 (3) [given by the projection]
_φ_ _ξ_ 0 ∶ **SE** 2 (3) [⋉] se 2 (3) [→M][. The choice of the state origin is]
arbitrary, however, a clever choice that makes the following
derivation easier is given by the identity of the symmetry
group, such that _ξ_ 0 = ( **I** _,_ **0** [∧] ). Moreover, given the choice of
the state origin _ξ_ 0 to be the identity, the output origin is
_y_ 0 = _h_ ( _ξ_ 0 ) = **I** .


_C. Lifted System_

The lift Λ together with the previously defined reference
origin _ξ_ 0 allow the construction of a lifted system on the
symmetry group **SE** 2 (3) [⋉] se 2 (3) [. Let] _**[ u]**_ [ ∈] [L][ be the system]
input and _X_ = ( _A,a_ ) ∈ **SE** 2 (3) [⋉] se 2 (3) [be the lifted system state,]
then, according to the general form _X_ [˙] = d _L_ _X_ Λ ( _φ_ _ξ_ 0 ( _X_ ) _,_ _**u**_ )
in [21], and considering the choice of the origin, the lifted
system kinematics for the biased inertial navigation system
follow


˙
_A_ = _A_ ( _**w**_ [∧] + Ad _A_ −1 [ _a_ ]) + _**g**_ [∧] _A_ + _f_ 1 [0] [(] _[A]_ [)] _[,]_ (14)


˙
_a_ = Ad _A_ [ad (−Ad _A_ −1 [ _a_ ]) [( _**w**_ [∧] + Ad _A_ −1 [ _a_ ])

(15)
+Ad _A_ −1 [ _[G]_ _**g**_ [∧] ] + _A_ [−][1] _f_ 1 [0] [(] _[A]_ [)] −] _[τ]_ [ ∧] []] _[.]_


VI. E QUIVARIANT F ILTER D ESIGN


Starting from this section we restore our original notation
of state and input variables.
The Equivariant Filter design follows the steps described in [15]. Let Λ be the equivariant lift defined in
Equ. (12)-(13), _X_ ˆ ∈ **SE** 2 (3) [⋉] se 2 ( _ξ_ 3)0 be the chosen identity state origin and [be the Equivariant Filter state, with initial]
condition _X_ [ˆ] (0) = ( _I,_ 0). Then the state evolves according to


˙ˆ
_X_ = d _L_ _X_ ˆ [Λ][(] _[φ]_ _[ξ]_ [0] [(][ ˆ] _[X]_ [)] _[,u]_ [) +][ d] _[R]_ [ ˆ] _X_ [∆] _[,]_



**C** [0] = [ **I** **0** ] ∈ R [9][×][18] _._ (26)


The output matrix **C** [0] is constant. The (1,1) and (1,2) blocks
of **A** [0] _t_ [are constant where the (1,2) block encodes a constant]
linear coupling of the bias states into the navigation states.
Note that for existing design methodologies, where the bias is



such that
_A_ ˙ˆ = ˆ _A_ ( _I_ _**w**_ ∧ + Ad _A_ ˆ [−][1] [ [] _[a]_ [ˆ][]) +] _[ G]_ _**[g]**_ [∧] _[A]_ [ˆ][ +] _[ f]_ 1 [ 0] [(] _[A]_ [ ˆ][) +][ ∆] [1] _[A,]_ [ˆ] (16)

˙ˆ
_a_ = ad − _a_ ˆ [(Ad _A_ ˆ [[] _[I]_ _**[w]**_ [∧] [] +][ ˆ] _[a]_ [) +] _[ G]_ _**[g]**_ [∧] [+] _[ f]_ 1 [ 0] [(] _[A]_ [ ˆ][)]]

(17)
− Ad _A_ ˆ [[] _[τ]_ [ ∧] [] +][ ∆] [2] [ +][ ad] [∆] [1] [[] _[a]_ [ˆ][]] _[.]_

The innovation term ∆ = (∆ 1 _,_ ∆ 2 ) is defined in the following analysis.


_A. Linearized Error and Output Dynamics_


Given the chosen identity state origin _ξ_ 0 and the Equivariant
Filter state _X_ [ˆ], the state error and the filter error are defined to
be respectively _e_ = _φ_ [−] _X_ ˆ [1] [(] _[ξ]_ [)][ and] _[ E]_ [ =] _[ X]_ [ ˆ] _[X]_ [−][1] [. Since we would]
like to have _ξ_ [ˆ] = _φ_ _X_ ˆ [(] _[ξ]_ [0] [) →] _[ξ]_ [, the Equivariant Filter goal is to]
drive the error _e_ → _ξ_ 0 .
To compute the linearized error dynamics we need to select
a chart and a chart transition map _ε_ ∶U _ξ_ 0 ⊂M → R [18] . If,
similarly to what has been done for the lift and the innovation,
we split the error _e_ ∈M in the following two components
_e_ = _φ_ [−] _X_ ˆ [1] [(] _[ξ]_ [) = (] _[e]_ [1] _[,e]_ [2] [)][. Then the chart transition map can be]
defined as


_ε_ ( _e_ ) = ( _ϵ_ 1 _,ϵ_ 2 ) = (log ( _e_ 1 ) [∨] _,e_ [∨] 2 [) ∈] [R] [18] _[,]_ (18)


and _ε_ ( _ξ_ 0 ) = **0** ∈ R [18] .
Therefore the linearized dynamics of _ε_ at **0** are


_ε_ ˙ ≈ **A** [0] _t_ _[ε]_ [ −] [D] _[e]_ [∣] _ξ_ 0 _[ε]_ [(] _[e]_ [)][ D] _[E]_ [∣] **I** _[φ]_ _[ξ]_ 0 [(] _[E]_ [)[][∆][]] _[,]_ (19)

**A** [0] _t_ [=][ D] _[e]_ [∣] _ξ_ 0 _[ε]_ [(] _[e]_ [)][ D] _[E]_ [∣] **I** _[φ]_ _[ξ]_ 0 [(] _[E]_ [)][ D] _[e]_ [∣] _ξ_ 0 [Λ] [(] _[e,]_ _**[ u]**_ [0] [)][ D] _[ε]_ [∣] **0** _[ε]_ [−][1] [ (] _[ε]_ [)] _[,]_
(20)


where _**u**_ 0 ∶= _ψ_ ( _X_ [ˆ] [−][1] _,_ _**u**_ ) is the origin input. The interested
reader is referred to [15] for a complete and detailed derivation
of the linearized error dynamics in Equ. (19).
Similarly, the output can be linearized by selecting a chart
and a chart transition map _δ_ ∶U _y_ 0 ⊂N → R [9] defined as


_δ_ ( _y_ ) = log ( _y_ ) [∨] _._ (21)


Then linearizing _δ_ as function of the coordinates _ε_ about _ε_ = **0**
yields


_δ_ ≈ **C** [0] _ε,_ (22)

**C** [0] = D _y_ ∣ _y_ 0 _δ_ ( _y_ ) D _e_ ∣ _ξ_ 0 _h_ ( _e_ ) D _ε_ ∣ **0** _ε_ [−][1] ( _ε_ ) _._ (23)


Solving the equations (20) and (23) for the linearized error
state matrix **A** [0] _t_ [and the linearized output matrix] **[ C]** [0] [ yields]


− **I**
**A** [0] _t_ [= [] **[Υ]** **0** **ad** [∨] (24)
( _[I]_ _**w**_ [∧] 0 [+] _[G]_ _**[g]**_ [∧] [)] [] ∈] [R] [18][×][18] _[,]_



⎤⎥⎥⎥⎥⎥⎦



**Υ** =



**0** **0** **0**

**0** **0** **I**

⎡⎢⎢⎢⎢⎢⎣ _G_ _**g**_ ∧ **0** **0**



∈ R [9][×][9] _,_ (25)


added without an integrated equivariant geometry, the coupling
in the (1,2) block of **A** [0] _t_ [will be time-varying and depends on]
the observer state. One way of understanding this difference is
that the bias for the EqF is estimated in a time-varying “frame
of reference” adapted to the symmetry of the navigation states.
Conversely, classical approaches, and the “imperfect” IEKF,
estimate the bias states in a copy of the Lie-algebra that is not
adapted to the symmetry. This structure leads to the improved
bias estimation results shown in the sequel. The (2,2) block
of the matrix **A** [0] _t_ [for the EqF encodes bias error dynamics]
induced by the time-variation of the body-frame.


_B. Equivariant Filter ODEs_

To summarize, let _X_ [ˆ] = ( _A,_ [ˆ] ˆ _a_ ) be the Equivariant Filter state
with initial condition _X_ [ˆ] (0) = ( _I,_ 0) and **Σ** ∈ S + (18) ⊂ R [18][×][18]

be the Riccati matrix with initial condition **Σ** (0) = **Σ** 0 . Let
**A** [0] _t_ [and] **[ C]** [0] [ be the matrices defined respectively in Equ. (24)]
and Equ. (26). Let ∆ = (∆ 1 _,_ ∆ 2 ) be the innovation term. Let
_**P**_ ∈ S + (18) ⊂ R [18][×][18] and _**Q**_ ∈ S + (9) ⊂ R [9][×][9] be respectively
a state gain matrix and an output gain matrix. Therefore,
the Equivariant Filter dynamics, the innovation term and the
Riccati Dynamics are

_A_ ˙ˆ = ˆ _A_ ( _I_ _**w**_ ∧ + Ad _A_ ˆ [−][1] [ [] _[a]_ [ˆ][]) +] _[ G]_ _**[g]**_ [∧] _[A]_ [ˆ][ +] _[ f]_ 1 [ 0] [(] _[A]_ [ ˆ][) +][ ∆] [1] _[A,]_ [ˆ] (27a)

˙ˆ
_a_ = ad − _a_ ˆ [(Ad _A_ ˆ [[] _[I]_ _**[w]**_ [∧] [] +][ ˆ] _[a]_ [) +] _[ G]_ _**[g]**_ [∧] [+] _[ f]_ 1 [ 0] [(] _[A]_ [ ˆ][)]]

(27b)
− Ad _A_ ˆ [[] _[τ]_ [ ∧] [] +][ ∆] [2] [ +][ ad] [∆] [1] [[] _[a]_ [ˆ][]] _[,]_

∆ = D _E_ ∣ **I** _φ_ _ξ_ 0 ( _E_ ) [†] d _ε_ [−][1] **ΣC** [0] _[T]_ _**Q**_ [−][1] _δ_ ( _ρ_ ˆ _X_ [−][1] [ (] _[y]_ [))] _[,]_ (27c)

**Σ** ˙ = **A** [0] _t_ **[Σ]** [ +] **[ ΣA]** _t_ [0] _T_ + _**P**_ − **ΣC** 0 _T_ _**Q**_ −1 **C** 0 **Σ** _._ (27d)


VII. S TABILITY A NALYSIS


**Theorem 7.1.** _Consider the observer_ (27) _computed for local_
_coordinates_ (18) (21) _and linearized model_ **A** [0] _t_ _[and]_ **[ C]** [0] _[ given]_
_by_ (24) _and_ (26) _. Assume that the trajectory ξ_ _t_ _and the_
_observer evolve such that the matrix pair_ ( **A** [0] _t_ _[,]_ **[C]** [0] [)] _[ is uni-]_
_formly observable. Then, there exists a local neighbourhood_
_of ξ_ 0 ∈M _such that for any initial condition of the system_
_such that the initial error e_ (0) _lies in this neighbourhood, the_
_observer_ (27) _is defined for all time and e_ ( _t_ ) → _ξ_ 0 _is locally_
_exponentially stable._


_Remark_ 7.2 _._ Note that the assumption on uniform observability of the error dynamics linearisation ( **A** [0] _t_ _[,]_ **[C]** [0] [)][ can be]
inferred from uniform observability of the state trajectory, at
least in a local neighbourhood [22]. The details of such an
extension are beyond the scope of the present article.


VIII. E XPERIMENTS


To validate the proposed Equivariant Filter design for a
biased inertial navigation system, we performed different
simulations, as well as, real-world experiments, of a UAV
carrying an IMU and receiving extended pose measurements.
In simulation, the UAV is navigating a spline interpolated
trajectory passing through randomly chosen waypoints, providing ground-truth values for the UAV position, orientation,
velocities (linear and angular), and acceleration. These values



Figure 1. Averaged norm of the navigation and biases error over the 15 runs.
**Left column:** Transient phase. **Right column:** Asymptotic phase. Note the
different _y_ -axes scale for the transient and the asymptotic phase.


Table I


R MSE Att [°] Pos [m] Vel [m/s] bias [rad/s] bias [m/s [2] ]
EqF ( _T_ ) **2** _._ **3032** 0 _._ 1884 **0** _._ **1480** **0** _._ **0224** 0 _._ 0937
MEKF ( _T_ ) 4 _._ 7448 **0** _._ **1819** 0 _._ 1751 0 _._ 0241 **0** _._ **0899**


EqF ( _A_ ) **0** _._ **5502** 0 _._ 0902 **0** _._ **0698** **0** _._ **0009** **0** _._ **0104**
MEKF ( _A_ ) 0 _._ 6896 **0** _._ **0815** 0 _._ 0713 0 _._ 0014 0 _._ 0146
Meas ( _A_ ) 7 _._ 8687 0 _._ 2496 0 _._ 2505 − −


were used to generate simulated extended pose measurements as well as simulated IMU measurements. In order to

replicate a real-world scenario, Gaussian noise was added
to both the simulated extended pose (modeled using the left
equation in Equ. (8)) and the IMU measurements. Moreover
non zero, time-varying biases (modeled as random walk
processes) were added to the simulated IMU measurements.
The standard deviation of the measurement noise values are
_σ_ _**w**_ = 1 _._ 3 ⋅ 10 [−][2] rad/s, and _σ_ _**a**_ = 8 _._ 3 ⋅ 10 [−][2] m/s [2] for simulated
IMU measurements reflecting the real IMU noise specification
onboard a AscTec Hummingbird quadcopter used in the real
world experiments, and _σ_ _**θ**_ = 8 _._ 7 ⋅ 10 [−][2] rad, _σ_ _**p**_ = 0 _._ 25m and
_σ_ _**v**_ = 0 _._ 1m/s for extended pose measurements.
In all the simulations and real-world experiments, the state
origin _ξ_ 0 was chosen to be the identity of the state space,


Figure 2. Initialization error in logarithmic scale. _e_ 1 represent the navigation
error, while _e_ 2 represent the biases error. The red area represents the region of
initial condition that lead to a failure of the MEKF, whereas the EqF converges
for each initial condition.


Table II


R MSE Att [°] Pos [m] Vel [m/s] bias [rad/s] bias [m/s [2] ]
EqF ( _**P**_ _T_ _, T_ ) **3** _._ **1313** **0** _._ **1022** **0** _._ **0530** **0** _._ **0694** **0** _._ **1331**
MEKF ( _**P**_ _T_ _, T_ ) FAIL FAIL FAIL FAIL FAIL


EqF ( _**P**_ _R_ _, T_ ) **3** _._ **1584** 0 _._ 1001 **0** _._ **0451** **0** _._ **0695** 0 _._ 1411
MEKF ( _**P**_ _R_ _, T_ ) 6 _._ 0439 **0** _._ **0812** 0 _._ 1362 0 _._ 0896 **0** _._ **1367**


leading to an identity output origin _y_ 0 . The state and the output
gain matrix for the Equivariant Filter were selected to reflect
input and output measurements noise respectively.
In the first simulation setup, the proposed EqF and a MEKF
were evaluated on a 15 runs Monte-Carlo simulation. Each run

has different input data, covering a time span of 120 s with
IMU provided at 100 Hz, and extended pose measurements
provided at 30 Hz, to account for different sensor clock
frequencies. Both filters were wrongly initialized with identity
orientation, zero position, velocity, and biases. The initial value
for the Riccati matrix was chosen to reflect the initial error.
Tab. I reports the averaged RMSE over the 15 runs, of the
navigation states and biases for the two filters, computed for
the first 40 s (the transient, _T_ ) and the last 40 s (the asymptotic
behaviour, _A_ ) of each run. Furthermore, Fig. 1 better shows the
trend of the averaged error, and the sample standard deviation,
of the navigation and biases states. It is of particular interest to
note the improved transient performance and the lower ∼ 30%
asymptotic error on the bias states, of the proposed EqF.
To show the benefit on the stability of the appropriate
geometric description of the nonlinear structure of the problem, we compared the EqF and the MEKF in a known
challenging condition for EKF-like filters, in particular, in
this simulation we consider a typical run with noise-free
IMU and extended pose measurements provided respectively
at 100 Hz, and 30 Hz. Both filters were wrongly initialized, and
different tuning of the state gain matrix _**P**_ were considered. An
appropriate tight tuning _**P**_ _T_ (small process noise), consistent
with a highly accurate IMU, and a robust tuning _**P**_ _R_ ≫ _**P**_ _T_
with artificially inflated process noise [23]. Tab. II shows
the RMSE of the transient phase for both filter tuning. With
tight tuning the MEKF diverges (denoted as FAIL Tab. II).
This is due to the gain quickly approaching zero whereas
the estimation error has not sufficiently decreased due to
nonlinearities. The EqF, instead, remains unaffected. A robust
tune with inflated process noise is required to make the MEKF
converge, however, this engineering trick often degrades the
stochastic performance of the filter given that the tuning is not
according to the sensors noise specifications.
To show the robustness of the proposed methodology to
different initial conditions, in the third simulation setup, we ran



a batch of 10 different runs with the same input data including
IMU and extended pose measurements provided respectively
at 100 Hz, and 30 Hz, but with different initialization of the
filters with increasing initialization error in all the states. The
initial value for the Riccati matrix was increased accordingly
with the initialization error. Fig. 2 shows the different initialization error in logarithmic scale. The proposed EqF exhibit
improved robustness to initialization error converging in each
run of the experiment whereas the MEKF diverges when the
initial error is high (red shaded area in Fig. 2). Unknown true
initial state is common in robotics application and improved
stability and robustness to wrong initialization are desirable
properties for an estimator.
Finally, the proposed EqF was evaluated, and compared with
a MEKF, on real-world in-flight data. Raw IMU readings were
recorded at 200 Hz on a AscTec Hummingbird quadcopter
flying a Lissajous curve [24], and raw pose measurements
gathered at ∼30 Hz from a OptiTrack motion capture system.
Velocity measurements were derived by numerical differentiation of the filtered position measurements. The obtained
extended pose measurements at 30 Hz were then added with
zero mean white Gaussian noise. Standard deviation of the

IMU, and extended pose, measurement noise values was set
to the aforementioned values. Tab. III shows the RMSE (on
the full trajectory) of the EqF compared to the EKF for the
navigation states on the real-world in-flight data. Note that
there is no ground-truth for the bias states, hence we omitted
the corresponding entries.


Table III


R MSE Att [°] Pos [m] Vel [m/s]

EqF **3** _._ **4448** **0** _._ **1210** **0** _._ **5224**

MEKF 3 _._ 9755 0 _._ 1357 0 _._ 5473


IX. C ONCLUSION


In this paper we presented a novel Equivariant Filter design
for the biased inertial navigation system. We introduced an
innovative input-bias extension to the original system formulation, together with a symmetry based on semi-direct product
group, that lead to the proof of the system’s equivariance. In
contrast to state-of-the-art solutions, we presented an equivariant observer for the concurrent estimation of navigation states
and input measurement biases characterized by a well behaving linearized error dynamics, asymptotic stability, improved
performance and robustness. The results shown in this paper
could lead to a series of work that can potentially bridge
the gap between existing geometric observers and practical
inertial-based navigation robotic applications since, to the best
of our knowledge, we are the first to show the inclusion of
bias terms as present in IMUs, in a tightly-coupled geometric
observer design. We validated our theoretical findings and the
proposed EqF in extensive simulation setup and real-world inflight data, specifically to show its improved accuracy, stability
and robustness compared to industry standard solutions for
robotics application.


R EFERENCES


[1] J. Krener, “The local convergence of the extended Kalman filter,” 2004.

[2] A. Barrau and S. Bonnabel, “The Invariant Extended Kalman Filter as
a Stable Observer,” _IEEE Transactions on Automatic Control_, vol. 62,
no. 4, pp. 1797–1812, 2017.

[3] G. Baldwin, R. Mahony, and J. Trumpf, “A nonlinear observer for 6
DOF pose estimation from inertial and bearing measurements,” in _2009_
_IEEE International Conference on Robotics and Automation_ . IEEE,
2009, pp. 2237–2242.

[4] H. A. Hashim and F. L. Lewis, “Nonlinear Stochastic Estimators on
the Special Euclidean Group SE(3) Using Uncertain IMU and Vision
Measurements,” _IEEE Transactions on Systems, Man, and Cybernetics:_
_Systems_, vol. 51, no. 12, pp. 7587–7600, 3 2020.

[5] H. A. Hashim, L. J. Brown, and K. McIsaac, “Nonlinear Pose Filters
on the Special Euclidean Group SE(3) with Guaranteed Transient and
Steady-State Performance,” _IEEE Transactions on Systems, Man, and_
_Cybernetics: Systems_, vol. 51, no. 5, pp. 2949–2962, 5 2021.

[6] Y. Ng, P. Van Goor, R. Mahony, and T. Hamel, “Attitude Observation
for Second Order Attitude Kinematics,” in _Proceedings of the IEEE_
_Conference on Decision and Control_, vol. 2019-Decem. IEEE, 2019,
pp. 2536–2542.

[7] Y. Ng, P. van Goor, and R. Mahony, “Pose Observation for Second Order
Pose Kinematics,” _IFAC-PapersOnLine_, vol. 53, no. 2, pp. 2317–2323,
1 2020.

[8] H. A. Hashim, M. Abouheaf, and M. A. Abido, “Geometric stochastic
filter with guaranteed performance for autonomous navigation based on
IMU and feature sensor fusion,” _Control Engineering Practice_, vol. 116,
p. 104926, 11 2021.

[9] A. Khosravian, J. Trumpf, R. Mahony, and C. Lageman, “Observers for
invariant systems on Lie groups with biased input measurements and
homogeneous outputs,” _Automatica_, vol. 55, pp. 19–26, 2015.

[10] A. S. Ludher, M. Tawhid, and H. A. Hashim, “Nonlinear Deterministic
Filter for Inertial Navigation and Bias Estimation with Guaranteed
Performance,” _2021 IEEE International Intelligent Transportation_
_Systems_ _Conference_ _(ITSC)_, pp. 3405–3411, 9 2021. [Online].
Available: https://ieeexplore.ieee.org/document/9565015/

[11] D. E. Zlotnik and J. R. Forbes, “Gradient-based observer for simultaneous localization and mapping,” _IEEE Transactions on Automatic Control_,
vol. 63, no. 12, pp. 4338–4344, 2018.

[12] A. Barrau, “Non-linear state error based extended Kalman filters with
applications to navigation,” Ph.D. dissertation, Mines Paristech, 9 2015.

[Online]. Available: https://hal.archives-ouvertes.fr/tel-01247723

[13] R. Hartley, M. Ghaffari, R. M. Eustice, and J. W. Grizzle, “Contact-aided
invariant extended Kalman filtering for robot state estimation,” _The_
_International Journal of Robotics Research_, vol. 39, no. 4, pp. 402–430,
2020. [Online]. Available: https://doi.org/10.1177/0278364919894385

[14] R. Mahony and J. Trumpf, “Equivariant Filter Design for Kinematic
Systems on Lie Groups,” _arXiv_, 2020.

[15] P. Van Goor, T. Hamel, and R. Mahony, “Equivariant Filter (EqF): A
General Filter Design for Systems on Homogeneous Spaces,” _Proceed-_
_ings of the IEEE Conference on Decision and Control_, vol. 2020-Decem,
no. Cdc, pp. 5401–5408, 2020.

[16] N. Pavlasek, A. Walsh, and J. R. Forbes, “Invariant Extended Kalman
Filtering Using Two Position Receivers for Extended Pose Estimation,”
in _2021 IEEE International Conference on Robotics and Automation_
_(ICRA)_ . Institute of Electrical and Electronics Engineers (IEEE), 10
2021, pp. 5582–5588.

[17] A. Fornasier, Y. Ng, R. Mahony, and S. Weiss, “Supplementary material
for “equivariant filter design for inertial navigation systems with input
measurement biases”,” 2022.

[18] R. Mahony, P. Van Goor, and T. Hamel, “Observer Design For Nonlinear
Systems With Equivariance,” 2021.

[19] R. Mahony, J. Trumpf, and T. Hamel, “Observers for kinematic systems with symmetry?” _IFAC Proceedings Volumes (IFAC-PapersOnline)_,
vol. 9, no. PART 1, pp. 617–633, 2013.

[20] M. Brossard, A. Barrau, P. Chauchat, and S. Bonnabel, “Associating
Uncertainty to Extended Poses for on Lie Group IMU Preintegration
With Rotating Earth,” _IEEE Transactions on Robotics_, 2021.

[21] R. Mahony, T. Hamel, and J. Trumpf, “Equivariant systems theory and
observer design,” _arXiv_, 2020.

[22] Y. Song and J. W. Grizzle, “Extended Kalman filter as a local asymptotic observer for nonlinear discrete-time systems,” _Proceedings of the_
_American Control Conference_, vol. 4, pp. 3365–3369, 1992.




[23] K. Reif, F. Sonnemann, and R. Unbehauen, “An EKF-Based Nonlinear
Observer with a Prescribed Degree of Stability,” _Automatica_, vol. 34,
no. 9, pp. 1119–1123, 9 1998.

[24] C. Böhm, M. Scheiber, and S. Weiss, “Filter-Based Online SystemParameter Estimation for Multicopter UAVs,” in _Robotics: Science and_
_Systems XVII_ . Robotics: Science and Systems Foundation, 7 2021, p. 9.

[Online]. Available: http://www.roboticsproceedings.org/rss17/p087.pdf


## **Supplementary Material for “Equivariant Filter Design for Inertial** **Navigation Systems with Input Measurement Biases”**

Alessandro Fornasier [1], Yonhon Ng [2], Robert Mahony [2] and Stephan Weiss [1]



This document provides supplementary material for the
ICRA 2022 submission “Equivariant Filter Design for Inertial
Navigation Systems with Input Measurement Biases” [1].


M ATHEMATICAL P RELIMINARIES


_A. Fréchet derivative_


Let _h_ ∶M →N be a continuous and differentiable

map between manifolds. The differential is writen
d _h_ ∶ TM → TN . Given _ξ_ ∈M and _η_ _ξ_ ∈ T _ξ_ M, the
differential d _h_ is evaluated pointwise by the Fréchet
derivative [2] as


d _h_ ( _ξ_ )[ _η_ _ξ_ ] = D _ζ_ ∣ _ξ_ _h_ ( _ζ_ )[ _η_ _ξ_ ] ∈ T _h_ ( _ξ_ ) N _._


_B. Left translation on the Semi-Direct product group_

Define the left translation on the semi-direct product
group **G** [⋉] g [by] _[ L]_ _[X]_ [∶] **[G]** [⋉] g [→] **[G]** [⋉] g [,] _[ L]_ _[X]_ _[Y]_ [ ∶=] _[ XY]_ [ . Define a map]
d _L_ _X_ ∶ T _Y_ **G** [⋉] g [→] [T] _[XY]_ **[G]** [⋉] g [by]


d _L_ ( _A,a_ ) [ _w_ 1 _,w_ 2 ] = ( _Aw_ 1 _,_ Ad _A_ [ _w_ 2 ]) _._


**Lemma 1.1.** d _L_ ( _A,a_ ) _is the differential of the left translation_
_L_ ( _A,a_ ) _._


_Proof._ Computing the differential of the left translation


D
( _B,b_ ) ∣ _I,_ 0 [((] _[A,a]_ [)(] _[B,b]_ [))[] _[w]_ [1] _[,w]_ [2] []]


= D
( _B,b_ ) ∣ _I,_ 0 [(] _[AB,a]_ [ +][ Ad] _[A]_ [[] _[b]_ [])[] _[w]_ [1] _[,w]_ [2] []]

= ( _Aw_ 1 _,_ Ad _A_ [ _w_ 2 ])

= d _L_ ( _A,a_ ) [ _w_ 1 _,w_ 2 ] _._


_C. Right translation on the Semi-Direct product group_

Define the right translation on the semi-direct product group
**G** [⋉] g [by] _[ R]_ _[X]_ [∶] **[G]** [⋉] g [→] **[G]** [⋉] g [,] _[ R]_ _[X]_ _[Y]_ [ ∶=] _[ Y X]_ [. Define a map][ d] _[R]_ _[X]_ [∶]
T _Y_ **G** [⋉] g [→] [T] _[Y X]_ **[G]** [⋉] g [by]


d _R_ ( _A,a_ ) [ _w_ 1 _,w_ 2 ] = ( _w_ 1 _A,w_ 2 + ad _w_ 1 [ _a_ ]) _._


**Lemma 1.2.** d _R_ ( _A,a_ ) _is the differential of the right translation_
_R_ ( _A,a_ ) _._


1 Alessandro Fornasier and Stephan Weiss are with the Control
of Networked Systems Group, University of Klagenfurt, Austria.
{alessandro.fornasier,stephan.weiss}@ieee.org
2 Yonhon Ng and Robert Mahony are with the System
Theory and Robotics Lab, Australian Centre for Robotic Vision,
Australian National University, Acton ACT 2601, Australia.
{yonhon.ng,robert.mahony}@anu.edu.au



_Proof._ Computing the differential of the right translation


D
( _B,b_ ) ∣ _I,_ 0 [((] _[B,b]_ [)(] _[A,a]_ [))[] _[w]_ [1] _[,w]_ [2] []]


= D
( _B,b_ ) ∣ _I,_ 0 [(] _[BA,b]_ [ +][ Ad] _[B]_ [[] _[a]_ [])[] _[w]_ [1] _[,w]_ [2] []]

= ( _w_ 1 _A,w_ 2 + ad _w_ 1 [ _a_ ])

= d _R_ ( _A,a_ ) [ _w_ 1 _,w_ 2 ] _._


P ROOFS


This section provides extended proofs of the Theorems and
Lemmas presented in the main document [1]. It should be
noted that the references to Lemmas, Theorems, and Equations
in this document refer to the original numbering from the main
document [1].


_D. Proof of Lemma 4.1_


**Lemma 4.1.** _Define φ_ ∶ **SE** 2 (3) [⋉] se 2 (3) [× M →M] _[ as]_


_φ_ ( _X,ξ_ ) ∶= ( **T** _A,_ Ad _A_ −1 [ _**b**_ [∧] − _a_ ]) _._


_Then, φ is a transitive right group action of_ **SE** 2 (3) [⋉] se 2 (3) _[on]_
M _._


_Proof._ Let _X,Y_ ∈ **SE** 2 (3) [⋉] se 2 (3) [and] _[ ξ]_ [ ∈M][. Then,]


_φ_ ( _X,φ_ ( _Y,ξ_ ))

= _φ_ ( _X,_ ( **T** _B,_ Ad _B_ −1 [ _**b**_ [∧] − _b_ ]))

= ( **T** _BA,_ Ad _A_ −1 [Ad _B_ −1 [ _**b**_ [∧] − _b_ ] − _a_ ])

= ( **T** _BA,_ Ad ( _BA_ ) −1 [ _**b**_ [∧] −( _b_ + Ad _B_ [ _a_ ])])

= _φ_ ( _Y X,ξ_ ) _._


This shows that _φ_ is a valid right group action. Then,
∀ _ξ_ 1 _,ξ_ 2 ∈M we can always write the group element
_Z_ = ( **T** [−] 1 [1] **[T]** [2] _[,]_ _**[ b]**_ [∧] 1 [−] [Ad] ( **T** [−] 1 [1] **T** 2 ) [[] _**[b]**_ 2 [∧] [])][, such that]


_φ_ ( _Z,ξ_ 1 ) = ( **T** 1 **T** [−] 1 [1] **[T]** [2] _[,]_

Ad ( **T** −11 **T** 2 ) [−][1] [ [] _**[b]**_ 1 [∧] [−] _**[b]**_ [∧] 1 [+][ Ad] ( **T** [−] 1 [1] **T** 2 ) [[] _**[b]**_ 2 [∧] []])]

= ( **T** 2 _,_ _**b**_ [∧] 2 [) =] _[ ξ]_ [2] _[,]_


which demonstrates the transitive property of the group action.


_E. Proof of Lemma 4.2_

**Lemma 4.2.** _Define ψ_ ∶ **SE** 2 (3) [⋉] se 2 (3) [×][ L][ →] [L] _[ as]_


_ψ_ ( _X,_ _**u**_ ) ∶= (Ad _A_ −1 [ _**w**_ [∧] − _a_ ] + _f_ 1 [0] [(] _[A]_ [−][1] [)] _[,]_ _**[ g]**_ [∧] _[,]_ [ Ad] _A_ [−][1] [ [] _[τ]_ [ ∧] [])] _[,]_


_where f_ 1 [0] [∶] **[SE]** [2] [(][3][) →] [T] **[SE]** [2] [(][3][)] _[ is given by Equ. (5). Then,][ ψ]_
_is a right group action of_ **SE** 2 (3) [⋉] se 2 (3) _[on]_ [ L] _[.]_


_Proof._ Let _X,Y_ ∈ **SE** 2 (3) [⋉] se 2 (3) [and] _**[ u]**_ [ ∈] [L][. Then,]


_ψ_ ( _X,ψ_ ( _Y,_ _**u**_ ))

= _ψ_ ( _X,_ (Ad _B_ −1 [ _**w**_ [∧] − _b_ ] + _f_ 1 [0] [(] _[B]_ [−][1] [)] _[,]_ _[ G]_ _**[g]**_ [∧] _[,]_ [ Ad] _B_ [−][1] [ [] _[τ]_ [ ∧] []))]

= (Ad _A_ −1 [Ad _B_ −1 [ _**w**_ [∧] − _b_ ] + _f_ 1 [0] [(] _[B]_ [−][1] [) −] _[a]_ [] +] _[ f]_ 1 [ 0] [(] _[A]_ [−][1] [)] _[,]_

_G_ _**g**_ ∧ _,_ Ad ( _BA_ ) −1 [ _τ_ ∧ ])

= (Ad ( _BA_ ) −1 [ _**w**_ [∧] −( _b_ + Ad _B_ [ _a_ ])] + Ad _A_ −1 [ _f_ 1 [0] [(] _[B]_ [−][1] [)]]

+ _f_ 1 [0] [(] _[A]_ [−][1] [)] _[,]_ _[ G]_ _**[g]**_ [∧] _[,]_ [ Ad] ( _BA_ ) [−][1] [ [] _[τ]_ [ ∧] [])] _[.]_


Due to the right invariant property of the drift field _f_ [0], it can
be shown that


( _f_ 1 [0] [(] _[A]_ [−][1] _[B]_ [−][1] [)] _[,]_ **[ 0]** [∧] [) = (] _[A]_ [−][1] _[f]_ 1 [ 0] [(] _[B]_ [−][1] [) +] _[ f]_ 1 [ 0] [(] _[A]_ [−][1] [)] _[,]_ **[ 0]** [∧] [)]

= (Ad _A_ −1 [ _f_ 1 [0] [(] _[B]_ [−][1] [)] +] _[ f]_ 1 [ 0] [(] _[A]_ [−][1] [)] _[,]_ **[ 0]** [∧] [)] _[.]_


Therefore,


_ψ_ ( _X,ψ_ ( _Y,_ _**u**_ ))

= (Ad ( _BA_ ) −1 [ _**w**_ [∧] −( _b_ + Ad _B_ [ _a_ ])]

+( _A_ [−][1] _f_ 1 [0] [(] _[B]_ [−][1] [) +] _[ f]_ 1 [ 0] [(] _[A]_ [−][1] [))] _[,]_ _[ G]_ _**[g]**_ [∧] _[,]_ [ Ad] ( _BA_ ) [−][1] [ [] _[τ]_ [ ∧] [])]

= _ψ_ ( _Y X,_ _**u**_ ) _._


Thus, proving that _ψ_ is a valid right group action.


_F. Proof of Theorem 4.3_


**Theorem 4.3.** _The biased inertial navigation system in Equ._
_(6) is equivariant under the actions φ in Equ. (9) and ψ in_
_Equ. (10) of the symmetry group_ **SE** 2 (3) [⋉] se 2 (3) _[. That is]_


_f_ [0] ( _ξ_ ) + _f_ _ψ_ _X_ ( _**u**_ ) ( _ξ_ ) = Φ _X_ _f_ [0] ( _ξ_ ) + Φ _X_ _f_ _**u**_ ( _ξ_ ) _._


_Proof._ Let _X_ ∈ **SE** 2 (3) [⋉] se 2 (3) [,] _ξ_ ∈M and _**u**_ ∈ L,
then _φ_ _X_ −1 ( _ξ_ ) = ( **T** _A_ [−][1] _,_ Ad _A_ [ _**b**_ [∧] ] + _a_ ) and
_f_ [0] ( _φ_ _X_ −1 ( _ξ_ )) + _f_ _**u**_ ( _φ_ _X_ −1 ( _ξ_ )) = ( _f_ 1 [0] [(] **[T]** _[A]_ [−][1] [)] _[,]_ **[0]** [∧] [) +]
( **T** _A_ [−][1] ( _**w**_ [∧] − Ad _A_ [ _**b**_ [∧] ] − _a_ ) + _**g**_ [∧] **T** _A_ [−][1] _, τ_ [∧] ), one has


Φ _X_ _f_ [0] ( _ξ_ ) + Φ _X_ _f_ _**u**_ ( _ξ_ )

∶= d _φ_ _X_ ( _f_ [0] ( _φ_ _X_ −1 ( _ξ_ )) + _f_ _**u**_ ( _φ_ _X_ −1 ( _ξ_ )))

= ( **T** _f_ 1 [0] [(] _[A]_ [−][1] [) +] _[ f]_ 1 [ 0] [(] **[T]** [)] _[,]_ **[0]** [∧] [)]

+ ( **T** _A_ [−][1] ( _**w**_ [∧] − Ad _A_ [ _**b**_ [∧] ] − _a_ ) _A_ + _**g**_ [∧] **T** _A_ [−][1] _A,_


Ad _A_ −1 [ _τ_ [∧]
])

= ( **T** (Ad _A_ −1 [ _**w**_ [∧] − _a_ ] + _f_ 1 [0] [(] _[A]_ [−][1] [) −] _**[b]**_ [∧] [) +] _**[ g]**_ [∧] **[T]** _[,]_

Ad _A_ −1 [ _τ_ [∧] ]) + ( _f_ 1 [0] [(] **[T]** [)] _[,]_ **[0]** [∧] [) =] _[ f]_ [ 0] [ (] _[ξ]_ [) +] _[ f]_ _ψ_ _X_ ( _**u**_ ) [(] _[ξ]_ [)] _[.]_


This proves the equivariance of the system.



_G. Proof of Lemma 4.5_

**Lemma 4.5.** _Define ρ_ ∶ **SE** 2 (3) [⋉] se 2 (3) [× N →N] _[ as]_


_ρ_ ( _X,y_ ) ∶= _yA._ (1)


_Then, the configuration output defined in Equ. (7) is equivari-_
_ant [3]._


_Proof._ Let _X_ = ( _A,a_ ) ∈ **SE** 2 (3) [⋉] se 2 (3) [and] _[ h]_ [(] _[ξ]_ [) =] **[ T]** [ ∈N]
then,
_ρ_ ( _X,h_ ( _ξ_ )) = **T** _A_ = _h_ ( _φ_ ( _X,ξ_ )) _._ (2)


This proves the output equivariance.


_H. Proof of Theorem 5.1_

**Theorem 5.1.** _Define_ Λ 1 ∶M × L → se 2 (3) _as_


Λ 1 ( _ξ,_ _**u**_ ) ∶= ( _**w**_ [∧] − _**b**_ [∧] ) + Ad **T** −1 [ _**g**_ [∧] ] + **T** [−][1] _f_ 1 [0] [(] **[T]** [)] _[.]_ (3)


_And, define_ Λ 2 ∶M × L → se 2 (3) _as_


Λ 2 ( _ξ,_ _**u**_ ) ∶= ad _**b**_ ∧ [Λ 1 ( _ξ,_ _**u**_ )] − _τ_ [∧] _._ (4)


_Then, the map_ Λ ( _ξ,_ _**u**_ ) = (Λ 1 ( _ξ,_ _**u**_ ) _,_ Λ 2 ( _ξ,_ _**u**_ )) _is an equiv-_
_ariant lift for the system in Equ. (6) with respect to the defined_

_symmetry group._


_Proof._ Let _ξ_ ∈M _,_ _**u**_ ∈ L and _X_ ∈ se 2 (3) [⋉] se 2 (3) [then]


_dφ_ _ξ_ ( **I** )[Λ 1 ( _ξ,_ _**u**_ ) _,_ Λ 2 ( _ξ,_ _**u**_ )]

= ( **T** Λ 1 ( _ξ,_ _**u**_ ) _,_ −ad Λ 1 ( _ξ,_ _**u**_ ) [ _**b**_ [∧] ] − Λ 2 ( _ξ,_ _**u**_ ))

= ( **T** ( _**w**_ [∧] − _**b**_ [∧] ) + _**g**_ [∧] **T** + _f_ 1 [0] [(] **[T]** [)] _[,]_

−ad Λ 1 ( _ξ,_ _**u**_ ) [ _**b**_ [∧] ] − ad _**b**_ ∧ [Λ 1 ( _ξ,_ _**u**_ )] + _τ_ [∧] )

= ( **T** ( _**w**_ [∧] − _**b**_ [∧] ) + _**g**_ [∧] **T** + _f_ 1 [0] [(] **[T]** [)] _[, τ]_ [ ∧] [)]

= _f_ [0] ( _ξ_ ) + _f_ ( _ξ,_ _**u**_ ) _,_


where we have made use of the anti-commutative property of the Lie bracket. To demonstrate the equivariance of the lift we have to show that the condition
Ad _X_ [Λ ( _φ_ _X_ ( _ξ_ ) _,ψ_ _X_ ( _**u**_ ))] = Λ ( _ξ,_ _**u**_ ) holds. Let _ξ_ ∈M _,_ _**u**_ ∈
L and _X_ ∈ **SE** 2 (3) [⋉] se 2 (3) [. The adjoint of the semi-direct prod-]
uct follows


Ad _X_ [Λ ( _φ_ _X_ ( _ξ_ ) _,ψ_ _X_ ( _**u**_ ))]


Ad _A_ [Λ 1 ( _φ_ _X_ ( _ξ_ ) _,ψ_ _X_ ( _**u**_ ))] _,_ Ω _,_
= ( )


where Ω is defined as


Ω = Ad _A_ [Λ 2 ( _φ_ _X_ ( _ξ_ ) _,ψ_ _X_ ( _**u**_ ))]−ad Ad _A_ [Λ 1 ( _φ_ _X_ ( _ξ_ ) _,ψ_ _X_ ( _**u**_ ))] [ _a_ ] _._


Then, we have


Ad _A_ [Λ 1 ( _φ_ _X_ ( _ξ_ ) _,ψ_ _X_ ( _**u**_ ))]

= Ad ( _A_ )[Ad _A_ −1 [ _**w**_ [∧] − _a_ ] + _f_ 1 [0] [(] _[A]_ [−][1] [) −] [Ad] _A_ [−][1] [ [] _**[b]**_ [∧] [−] _[a]_ []]

+Ad _A_ −1 [Ad **T** −1 [ _**g**_ [∧] ]] + _A_ [−][1] **T** [−][1] _f_ 1 [0] [(] **[T]** _[A]_ [)]]

= ( _**w**_ [∧] − _**b**_ [∧] ) + Ad **T** −1 [ _**g**_ [∧] ] + **T** [−][1] _f_ 1 [0] [(] **[T]** _[A]_ [) +] _[ Af]_ 1 [ 0] [(] _[A]_ [−][1] [)]

= ( _**w**_ [∧] − _**b**_ [∧] ) + Ad **T** −1 [ _**g**_ [∧] ] + **T** [−][1] _f_ 1 [0] [(] **[T]** [) =][ Λ] [1] [(] _[ξ,]_ _**[u]**_ [)] _[,]_


where we have employed the right invariant property of _f_ [0]

and the fact that _Af_ 1 [0] [(] _[A]_ [−][1] [) = −] _[f]_ 1 [ 0] [(] _[A]_ [)][. Moreover,]


Ω = Ad _A_ [Λ 2 ( _φ_ _X_ ( _ξ_ ) _,ψ_ _X_ ( _**u**_ ))] − ad Λ 1 ( _ξ,_ _**u**_ ) [ _a_ ]

= Ad _A_ [−ad Λ 1 ( _φ_ _X_ ( _ξ_ ) _,ψ_ _X_ ( _**u**_ )) [Ad _A_ −1 [ _**b**_ [∧] − _a_ ]]]

− _τ_ [∧] − ad Λ 1 ( _ξ,_ _**u**_ ) [ _a_ ]

= −ad Ad _A_ [Λ 1 ( _φ_ _X_ ( _ξ_ ) _,ψ_ _X_ ( _**u**_ ))] [ _**b**_ [∧] − _a_ ]

− _τ_ [∧] − ad Λ 1 ( _ξ,_ _**u**_ ) [ _a_ ]

= ad _**b**_ ∧ [Λ 1 ( _ξ,_ _**u**_ )] − _τ_ [∧] = Λ 2 ( _ξ,_ _**u**_ ) _._


_I. Proof of Theorem 7.1_


**Theorem 7.1.** _Consider the observer in Equ. (27) computed_
_for local coordinates in Equ. (18), (21) and linearized model_
**A** [0] _t_ _[and]_ **[ C]** [0] _[ given by Equ. (24) and (26). Assume that the]_
_trajectory ξ_ _t_ _and the observer evolve such that the matrix_
_pair_ ( **A** [0] _t_ _[,]_ **[C]** [0] [)] _[ is uniformly observable. Then, there exists a]_
_local neighbourhood of ξ_ 0 ∈M _such that for any initial_
_condition of the system such that the initial error e_ (0) _lies in_
_this neighbourhood, the observer (27) is defined for all time_
_and e_ ( _t_ ) → _ξ_ 0 _is locally exponentially stable._


_Proof._ Assume that the initial condition for the state and the
observer is such that the error lies in the local coordinate

neighbourhood U _ξ_ - Equ. (18). By continuity, there exists a
time _T_ - 0 (possibly infinite) on which the observer solution
is well defined, continuous and the error remains in U for
_t_ ∈[0 _,T_ ). Since ( **A** [0] _t_ _[,]_ **[C]** [0] [)][ are uniformly observable and the]
gain matrices are bounded strictly-positive matrices, then there
exists constants 0 < _σ_ 1 < _σ_ 2 < ∞ such that the solution of the
Riccati equation Equ. (27d) satisfies [4] _σ_ 1 _I_ _m_ < **Σ** ( _t_ ) < _σ_ 2 _I_ _m_
for _t_ ∈[0 _,T_ ). Define L _t_ = _ε_ [⊺] **Σ** [−][1] _ε._ Consider the linearized
error dynamics Equ. (19) and Equ. (22) on the interval [0 _,T_ ).
One has

d
d _t_ [L] _[t]_ [ = −] _[ε]_ [⊺] [(] **[Σ]** [−][1] **[PΣ]** [−][1] [ +] **[ C]** [0][⊺] **[Q]** [−][1] **[C]** [0] [)] _[ε.]_

Since the right-hand side is negative definite, then there exists
a neighbourhood of 0 in the linearised error coordinates _ϵ_
(corresponding to a neighbourhood U 1 of _ξ_ [○] in the error
coordinates _e_ ) such that dd _t_ [L] _[t]_ [ <][ 0][ for the full nonlinear error]
dynamics. Since **Σ** ( _t_ ) is bounded below and above, there
exists a value L 0 - 0 such that L [−] _t_ [1] [([][0] _[,]_ [L] [0] []) ⊂U] _[ξ]_ [○] [∩U] [1]
as a function of _ε_ for all times _t_ . It follows that for any
initial condition such that the error _ε_ ( _e_ ) ∈L [−] _t_ [1] [([][0] _[,]_ [L] [0] [])][ then]
L( _t_ ) < L 0 for all time and the solution exists and the error
remains in U _ξ_ - ∩U 1 for all time. Exponential stability of the
linearised error _ε_ follows directly from Lyapunov’s second
method and local exponential stability of the error _e_ for the
full nonlinear system follows from the standard properties of
linearisation and local coordinates.


R EFERENCES


[1] A. Fornasier, Y. Ng, R. Mahony, and S. Weiss, “Equivariant filter design
for inertial navigation systems with input measurement biases,” in _2022_
_IEEE International Conference on Robotics and Automation (ICRA)_,
2022.




[2] R. Coleman, “Calculus on Normed Vector Spaces,” 2012. [Online].
Available: http://link.springer.com/10.1007/978-1-4614-3894-6

[3] P. Van Goor, T. Hamel, and R. Mahony, “Equivariant Filter (EqF): A
General Filter Design for Systems on Homogeneous Spaces,” _Proceedings_
_of the IEEE Conference on Decision and Control_, vol. 2020-Decem, no.
Cdc, pp. 5401–5408, 2020.

[4] R. S. Bucy, “Global theory of the Riccati equation,” _Journal of computer_
_and system sciences_, vol. 1, no. 4, pp. 349–361, 1967.


