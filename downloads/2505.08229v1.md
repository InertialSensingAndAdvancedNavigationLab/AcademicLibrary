# Constrained Factor Graph Optimization for Robust Networked Pedestrian Inertial Navigation



Yingjie Hu
Dept. of Aerospace
Engineering and Mechanics,
Univ. of Minnesota, Twin Cities,
Minnesota 55455, USA.

Email: hu000258@umn.edu


_**Abstract**_ **—This paper presents a novel constrained Factor**
**Graph Optimization (FGO)-based approach for networked iner-**
**tial navigation in pedestrian localization. To effectively mitigate**
**the drift inherent in inertial navigation solutions, we incorporate**
**kinematic constraints directly into the nonlinear optimization**
**framework. Specifically, we utilize equality constraints, such**
**as Zero-Velocity Updates (ZUPTs), and inequality constraints**
**representing the maximum allowable distance between body-**
**mounted Inertial Measurement Units (IMUs) based on human**
**anatomical limitations. While equality constraints are straightfor-**
**wardly integrated as error factors, inequality constraints cannot**
**be explicitly represented in standard FGO formulations. To**
**address this, we introduce a differentiable softmax-based penalty**
**term in the FGO cost function to enforce inequality constraints**
**smoothly and robustly. The proposed constrained FGO approach**
**leverages temporal correlations across multiple epochs, resulting**
**in optimal state trajectory estimates while consistently main-**
**taining constraint satisfaction. Experimental results confirm that**
**our method outperforms conventional Kalman filter approaches,**
**demonstrating its effectiveness and robustness for pedestrian**
**navigation.**
_**Index Terms**_ **—Factor Graph Optimization, Inertial Navigation,**
**Constrained Optimization, Kalman Filter, Pedestrian Navigation**


I. I NTRODUCTION

Networked inertial navigation has recently emerged as a
promising approach for pedestrian localization, leveraging the
fusion of measurements from multiple Inertial Measurement
Unit (IMU)s. However, Inertial Navigation System (INS)
inherently suffer from accuracy degradation over time due to
the integration of measurement errors such as sensor noise,
uncompensated biases, and residual biases [1]. These accumulated errors lead to substantial position drift, particularly
evident in extended navigation tasks.
A common solution to mitigate INS drift involves integrating external aiding sensors, including Global Navigation
Satellite Systems (GNSS), Ultra-Wideband (UWB), radar, and
LiDAR [2] . Beyond external sensors, constraints derived
from known relationships among state variables, such as kinematics, dynamics, or geometry, also provide valuable aiding
information [3], [4]. The Zero-Velocity Updates (ZUPT) is a
prominent example of a kinematic constraint widely adopted
for pedestrian navigation, exploiting the known zero velocity
during the stance phase of a gait cycle [3].



Wang Hu
Dept. of Electrical and
Computer Engineering,
Univ. of California, Riverside,
CA 92521, USA.

Email: whu027@ucr.edu


For Kalman Filter (KF)-based INS, two principal methodologies incorporate constraints into the estimation process:
the pseudo-observation approach [5], [6] and the projection
approach [4], [7]. The pseudo-observation method integrates
equality constraints directly as additional observations, while
the projection approach can handle both equality and inequality constraints by formulating and solving constrained
optimization problems to yield state estimates that strictly
satisfy the imposed constraints.
The Factor Graph Optimization (FGO) approach, a nonlinear optimization framework based on Maximum A Posteriori
(MAP) estimation, has recently gained traction as an alternative to traditional KF-based approaches due to their ability to
comprehensively exploit temporal correlations across multiple
epochs [8], [9]. In FGO frameworks, each node represents
a system state at a specific epoch, with edges encoding the
dynamics and measurement relationships, thus constructing an
optimization problem reflecting all historical data within the
considered batch. By solving this batch optimization, FGO
methods have shown robustness against cumulative drift compared to single-epoch updates typical of KF-based methods

[9], [10].
As an alternative to KF-based methods, optimization-based
approaches have been widely studied for PNT problems.
Factor Graph Optimization (FGO) is a nonlinear optimization
framework based on maximum _a posteriori_ (MAP) estimation

[8]. In a factor graph, each node represents the system state
vector at a specific epoch, while edges encode system dynamics and measurement relationships. This leads to a nonlinear, unconstrained optimization problem that mathematically
represents the factor graph. The optimal state trajectory is
obtained by solving this optimization problem, the cost function of which is the sum of Mahalanobis distances (assuming
Gaussian noise), representing the state transition and measurement residuals over the current data batch. Compared to
conventional KF-based approaches, FGO leverages the batch
of historical data and fully exploits the temporal correlations
between states and observations across multiple epochs.
In this paper, we propose a constrained FGO-based approach specifically tailored for networked pedestrian inertial
navigation. Our method integrates two essential types of


constraints into the factor graph formulation: (1) equality
constraints such as ZUPTs and (2) inequality constraints
representing the maximum allowable distances between bodymounted IMUs, reflective of human physiological dimensions.
ZUPT constraints are straightforwardly represented as error
factors within the factor graph. However, inequality constraints
pose challenges due to their non-direct formulation within
standard FGO methods. To address this, we introduce a
softmax-based penalty into the FGO cost function, providing
a differentiable and stable approximation to enforce these
inequality constraints effectively.
Unlike conventional constrained Kalman filters, which enforce constraints only at the current estimation epoch, our proposed constrained FGO exploits the temporal structure of data
across the entire measurement batch. This approach ensures
optimal trajectory estimation while consistently satisfying all
constraints at every epoch, significantly mitigating position
drift and enhancing localization accuracy in pedestrian navigation scenarios.
Experimental evaluations using real-world datasets demonstrate the effectiveness of our proposed constrained FGO
method, showcasing considerable improvements in positioning
accuracy compared to traditional constrained KF approaches.
The contributions of this work are summarized as follows:


_•_ Development of a novel FGO-based networked inertial
navigation framework integrating both equality and inequality constraints.

_•_ Proposal of a softmax-based penalty method within the
FGO framework for incorporating inequality constraints
related to human biomechanical limits.


_•_ Experimental validation demonstrating superior navigation accuracy and robustness over conventional KF-based
methods.


II. P ROBLEM S TATEMENT


The personal navigation problem considered in this work
involves fusing measurements from body-mounted inertial
sensors to estimate a pedestrian’s trajectory. The proposed
networked pedestrian navigation system utilizes two footmounted IMUs as the primary navigation sensors. To improve
estimation accuracy and reduce drift, the sensor fusion framework incorporates both ZUPT constraints and a constraint on
the maximum distance between the feet.

In multi-agent Positioning, Navigation, Timing (PNT) systems, two common data fusion architectures are centralized
and decentralized. In a decentralized architecture, each agent
runs an independent estimator, and inter-agent correlations
are indirectly established through occasional information exchange. However, decentralized systems generally lack mechanisms to explicitly manage cross-agent correlations. In contrast, a centralized architecture maintains a single global
estimator that jointly models all agent states, allowing interagent correlations to be preserved directly through the global
covariance matrix. This centralized structure enables all agents
to benefit collectively from shared measurements and con


straints. Therefore, a centralized fusion scheme is adopted for
the two-IMU configuration in this study.
The navigation system consists of two IMU nodes. The state
vector for each individual IMU is defined as:


_s_ **x** _i_ = [ _s_ **p** _i_ ; _s_ **v** _i_ ; _s_ _**ρ**_ _i_ ; _s_ **b** _a,i_ ; _s_ **b** _g,i_ ] (1)


where the superscript _s_ refers to the _s_ -th IMU ( _s_ = 1 _,_ 2). Each
state vector is 16 _×_ 1 and includes the position **p**, velocity
**v**, quaternion _**ρ**_, and accelerometer biases **b** _a_, and gyroscope
biases **b** _g_ . The full state vector of the centralized system is
formed by concatenating the individual IMU state vectors:


**x** = [ [1] **x** _i_ ; [2] **x** _i_ ] _._ (2)


State propagation for each IMU is performed using standard inertial navigation mechanization. Relevant references for
**INS!** ( **INS!** ) mechanization can be found in [2].
GNSS signals of good quality are not always available in
personal navigation scenarios due to environmental limitations,
such as indoor settings or deep urban canyons. In such cases,
other external aiding sensors, e.g., cameras and UWB, can be
utilized to help the navigation. In addition to external aiding
sensors, constraints derived from kinematics/dynamics can be
employed to assist navigation. Zero-velocity update (ZUPT)
is one of the most commonly used kinematic constraints in
personal navigation and automotive navigation. In personal
navigation, a subject’s gait cycle alternates between the stance
phases and the swing phases. During the swing phase, the
corresponding foot is above the ground and moving in the air
until it touches the ground. In comparison, the stance phase
refers to the period in which the foot is in contact with the
ground. An assumption can be made that the instantaneous
velocity of the food in the stance phase is zero. This zerovelocity information serves as a pseudo-measurement that
can be incorporated into the estimation framework to reduce
position drift. Because the gait cycle alternates between these
phases, ZUPT measurements become periodically available
throughout the walking process.
ZUPT constraints are incorporated into the filtering framework as pseudo-measurements. Another source of constraints
comes from the physical limitation on the size of the human
body. For instance, the maximum foot separation of a human
subject has an upper bound. For the two foot-mounted IMUs,
this inter-foot distance constraint can be applied to limit the
relative positions of the IMU nodes and potentially reduce
drift. Unlike ZUPT, which can be treated as a direct pseudomeasurement, the inter-foot separation constraint takes the
form of an inequality constraint. To incorporate inequality
constraints into the filtering process, the projection approach is
commonly used [11]. This method projects the unconstrained
state estimate onto the constraint surface to satisfy the constraint. The constraint Kalman filter can be usually formulated
as the constrained optimization problem as follows:

**x** ˆ _[∗]_ = argmin **P** [+] [�] _[−]_ [1] ( **x** _−_ **x** ˆ [+] ) s.t. **D** ( **x** ) _≤_ **d** (3)
**x** [(] **[x]** _[−]_ **[x]** [ˆ] [+] [)] _[T]_ [ �]


in which, ˆ **x** [+] denotes the unconstrained state estimate and
its corresponding error covariance matrix is **P** [+] . The state


has to satisfy the inequality constraint **D** ( **x** ) _≤_ **d** . Solving the
constrained optimization problem in (3) yields the constrained
state estimate ˆ **x** _[∗]_ .


III. M ETHODOLOGY


In this paper, we consider a dual-IMU networked inertial
navigation system, configured by mounting one IMU on each
foot of the pedestrian. As a result, ZUPT constraints are
available independently for both IMUs. When a foot is in
full contact with the ground, the instantaneous velocity of the
corresponding IMU is assumed to be zero. The zero-velocity
detection is performed based on the magnitude of IMU measurements from accelerometers and gyroscopes. Specifically,
epochs for applying ZUPT constraints are identified whenever the norm of these IMU sensor outputs drops below
predefined thresholds. Additionally, the inter-foot distance
serves as another kinematic constraint. Given the physical
limitations imposed by human limb length, an upper bound
naturally exists on the distance between the two foot-mounted
IMUs. This inter-foot distance constraint is modeled as an

inequality constraint on the positions of the IMU nodes. Unlike
ZUPT constraints, which are dynamically activated based on
detected foot stance phases, the inter-foot distance constraint
is enforced periodically at fixed intervals to ensure consistent
adherence to the upper bound throughout the entire navigation
period.
A factor graph is constructed to model the dual-IMU
navigation system for pedestrian localization, incorporating
these kinematic constraints to mitigate position drift. The
architecture of the proposed FGO-based personal navigation
algorithm is illustrated in Fig. 1. It should be noted that not
all epochs include position, ZUPT, and inter-foot distance
constraint factors simultaneously. The presence of each factor
type depends on data availability and scheduling: position factors are integrated only when external position measurements
are available; ZUPT factors are dynamically activated upon
detecting zero-velocity conditions; and inter-foot distance constraint factors are applied at predetermined fixed intervals. The
centralized navigation state is defined in (2), containing the
16 _×_ 1 state vector for each IMU. The remainder of this section

will elaborate on each factor involved in the FGO architecture

to formulate the nonlinear optimization clearly.
**IMU Preintegration Factor** : The INS mechanization equations govern how each IMU’s navigation states propagate
over time. These equations impose dynamic constraints on the
transition between consecutive states. However, due to the high
sampling rate of IMU measurements, the computational load
of FGO will become prohibitive if all the IMU states are to be
processed. To alleviate the computational burden, a technique
called IMU preintegration is introduced [10], which allows
the integration of high-frequency IMU data without requiring
every measurement to be directly included in the optimization
problem, significantly reducing computational complexity. The
resulting IMU preintegration factor is denoted by _∥e_ IMU _,i_ _∥_ [2] and
the detailed derivation of _∥e_ IMU _,i_ _∥_ [2] can be found in [10], [12].



Fig. 1: Architecture of the proposed FGO-based personal
navigation algorithm. The subscript 1 : _T_ denotes the indices
within the sliding window.


**Zero Velocity Factor** : ZUPT constraints are represented
as zero velocity factors at epochs when a foot is in contact
with the ground, implying zero instantaneous velocity. The
zero-velocity factor encodes the velocity information for the
corresponding IMU states.

_∥e_ ZUPT _,i_ _∥_ **R** [2] ZUPT _,i_ [=] _[ ∥]_ **[y]** [ZUPT] _[,][i]_ _[−]_ **[H]** [ZUPT] **[x]** _[i]_ _[∥]_ [2] **R** ZUPT _,i_ _[.]_ (4)


where **y** ZUPT _,i_ represents the zero velocity measurement, that is,
**y** ZUPT _,i_ = **0** . **R** ZUPT _,i_ denotes the covariance matrix of the zero
velocity measurement noise. The measurement matrix **H** ZUPT
can be determined as:


_•_ When the right foot is in stance phase:


**H** ZUPT = � **0** 3 _×_ 3 **I** 3 _×_ 3 **0** 3 _×_ 9 **0** 3 _×_ 15 � (5)


_•_ When left foot is in stance phase:


**H** ZUPT = � **0** 3 _×_ 15 **0** 3 _×_ 3 **I** 3 _×_ 3 **0** 3 _×_ 9 � (6)


_•_ When both right and left feet are in stance phase:



**H** ZUPT = � **00** 33 _××_ 153 **0I** 33 _××_ 33 **0I** 33 _××_ 39 **00** 33 _××_ 159



(7)
�



**Inter-Foot Distance Constraint Factor** : Due to the lim
itation on the physical size of the human body, the distance
between two feet cannot be greater than a certain upper bound.
This inter-foot distance constraint can be expressed by


_∥_ [1] **p** _i_ _−_ [2] **p** _i_ _∥_ 2 _−_ _d ≤_ 0 (8)


where, [1] **p** _i_ and [2] **p** _i_ denote the position vectors of the two footmounted IMUs, _∥·∥_ 2 is the 2-norm operator and _d_ represents
the upper bound of the inter-foot distance. Unlike the zero
velocity constraint, equation (8) is an explicit inequality constraint, which cannot be directly incorporated into the FGO
formulation as constraint factors. To address this issue, we
propose augmenting the nonlinear graph optimization with
the softmax penalty that represents the inequality distance
constraint. The softmax penalty of the distance constraint can
be expressed as

softmax (∆ _d_ _i_ ) = [1] 1 + _e_ _[α]_ [∆] _[d]_ _[i]_ (9a)

_α_ [log] � �

∆ _d_ _i_ = _∥_ [1] **p** _i_ _−_ [2] **p** _i_ _∥_ 2 _−_ _d_ (9b)


where, parameter _α_ is the sharpness variable that controls how
closely the softmax function approximates the hard max function max(0 _,_ ∆ _d_ _i_ ). The hard max function aligns with the active
set method [13] for constrained optimization problems. When
∆ _d_ = _∥_ [1] **p** _i_ _−_ [2] **p** _i_ _∥_ 2 _−_ _d >_ 0, the constraint (8) is not satisfied
and is, thus, an active constraint. Accordingly, the hard max
penalty max(0 _,_ ∆ _d_ _i_ ) = ∆ _d_ _i_ is augmented to penalize the cost
function. On the other hand, when ∆ _d_ _i_ = _∥_ [1] **p** _i_ _−_ [2] **p** _i_ _∥_ 2 _−_ _d ≤_ 0,
the constraint (8) is met and becomes an inactive constraint.
The hard max penalty reduces to zero, indicating that the
constraint has no impact on the optimization. However, the
hard max penalty is not differentiable at ∆ _d_ _i_ = 0, which
can cause instability in gradient-based optimization when
solving the FGO. In comparison, the softmax penalty approach
is smooth and differentiable, and more numerically stable,
making it better suited for FGO solving using gradient-based
solvers, such as Levenberg-Marquardt, Gauss-Newton.
**Position Factor:** In addition to the ZUPT and inter-foot

distance constraint, position measurements are formulated as
factors when they become available. The position factor is
represented by

_∥e_ pos _,i_ _∥_ **R** [2] pos _,i_ [=] _[ ∥]_ **[y]** [pos] _[,][i]_ _[−]_ **[H]** [pos] **[x]** _[i]_ _[∥]_ [2] **R** pos _,i_ (10)


The loosely coupled GNSS/INS integration is adopted in this
paper where the IMU and position information are fused
on the navigation solution level. **y** pos _,i_ denotes the position
measurements and **R** pos _,i_ is the covariance matrix for the
position measurement noise. The measurement matrix **H** pos is



**H** pos = � **0I** **33** _××_ **33** **00** **33** _××_ **1212** **0I** **33** _××_ **33** **00** **33** _××_ **1212**



(11)
�



2 algorithms (iSAM2) [9] is used in our implementation to
solve the nonlinear graphical optimization.


IV. E XPERIMENT


To evaluate the effectiveness of the proposed constrained
FGO-based algorithm for pedestrian localization, a real-world
experiment was conducted. The proposed method was compared with an Extended Kalman Filter (EKF) approach that
incorporates position measurements, ZUPT, and inter-foot
distance constraints. In the EKF implementation, ZUPT is
integrated using the pseudo-observation method, while the
inter-foot distance constraint is handled via the projection
approach. Position measurements, when available, are fused
into the EKF using a loosely coupled integration scheme.
Data collection was carried out in the Shepherd Drone Lab
at the University of Minnesota, which is equipped with a highprecision optical motion capture system (PhaseSpace Impulse
X2E) [15]. This system tracks the positions of LED markers
with centimeter-level of accuracy, and was used to obtain
ground truth trajectories for the evaluation. To simulate realworld conditions, noisy and corrupted position measurements
were generated from the ground-truth trajectory. Specifically,
zero-mean Gaussian noise with a standard deviation of 30

centimeters was added to the true positions, mimicking typical
measurement noise in real-world GNSS data. Additionally,
outliers were introduced by injecting occasional large biases
randomly selected from a predefined set of values. These
outliers emulate the severe errors that can occur in GNSS
denied or multipath-rich environments [16], such as urban
canyons or indoor settings. For the purpose of this study,
position measurements were assumed to be available at 0.5second intervals [1] . The horizontal-plane errors of these corrupted position measurements for both feet are shown in Fig. 4.
Xsens DOT units [17] were used as the IMUs in this experiment, capable of providing raw specific force and angular
velocity data. One IMU was mounted on each foot of the
subject. LED markers were affixed on top of the IMUs to
track their global positions within the motion capture system’s
reference frame. The IMUs recorded data at 60 Hz, while the
motion capture system operated at 960 Hz. Post-processing
was required to synchronize the two data streams.
The human subject wearing the IMUs walked throughout
the test area, and all collected data were processed offline. The
same dataset was used to evaluate both the proposed acfgobased method and the EKF approach. The following methods
were compared:


_•_ EKF  - ZUPT : EKF with ZUPT constraints;


_•_ EKF  - ZUPT  - STEP : EKF with ZUPT and inter-foot distance

constraints;

_•_ EKF  - ZUPT  - POS : EKF with ZUPT and position measure
ments;

_•_ EKF  - ZUPT  - POS  - STEP : EKF with ZUPT, inter-foot distance, and position measurements;


1 [The source code for the experiment is available at https://github.com/](https://github.com/Azurehappen/Constrained-ZUPT-FGO)
[Azurehappen/Constrained-ZUPT-FGO](https://github.com/Azurehappen/Constrained-ZUPT-FGO)



**Prior Information Factor:** The prior information can be
formulated as a factor incorporated into the FGO formulation.
For instance, if the _a priori_ state estimate at the first time step
is ˆ **x** _[−]_ 0 [and the corresponding error covariance matrix is] **[ P]** _[−]_ 0 [, the]
prior information factor can be written as

_∥e_ pri _∥_ [2] **P** _[−]_ 0 [=] _[ ∥]_ **[x]** [0] _[ −]_ **[x]** [ˆ] 0 _[−]_ _[∥]_ [2] **P** _[−]_ 0 _[.]_ (12)


Using (4), (9a), (10), and (12), the cost function of the FGO
can be formulated as


_T_
### x ˆ 0:T = argmin x 0:T ∥e pri ∥ [2] P [−] 0 [+] i ∑ =1 ( a i ∥e ZUPT,i ∥ R [2] ZUPT,i [+] [b] [i] [∥][e] [pos] [,][i] [∥] R [2] pos,i [)]


_T_ _−_ 1 _T_
### + ∑ ∥e IMU,i ∥ [2] Q IMU,i [+] ∑ λ i softmax (∆ d i ) .

_i_ =1 _i_ =1

(13)
in which, _a_ _i_ _∈{_ 0 _,_ 1 _}_ and _b_ _i_ _∈{_ 0 _,_ 1 _}_ are the parameters
indicating if ZUPT and position measurements are available
for the current time step _i_ . For example, _a_ _i_ = 1 indicates that
ZUPT measurement is available and _b_ _i_ = 0 indicates that there
are no position measurements for the current time step _i_ . _λ_ _i_ is
the penalty weight parameter for the softmax penalty at time
step _i_ . The proposed FGO-based personal navigation algorithm
is implemented using the open-source GTSAM [14] package
in Python. In order to increase the computational efficiency
of the proposed algorithm, incremental nonlinear optimization


_•_ FGO  - ZUPT : FGO with ZUPT constraints;


_•_ FGO  - ZUPT  - STEP : FGO with ZUPT and inter-foot distance

constraints;

_•_ FGO  - ZUPT  - POS : FGO with ZUPT and position measure
ments;

_•_ FGO  - ZUPT  - POS  - STEP : FGO with ZUPT, inter-foot distance, and position measurements;
Fig. 2 shows the estimated trajectory of FGO-ZUPTPOS-STEP (orange) compared to the ground truth trajectory
(blue) for a 2-minute walking session. The estimated trajectory
follows the ground truth with good accuracy. In comparison,
Fig. 3 illustrates the estimated trajectory using EKF-ZUPTPOS-STEP for the same dataset, which exhibits relative larger
position errors. Performance comparisons among all methods
are summarized in Tables I through IV, using metrics including
mean error, root-mean-square (RMS) error, and maximum error. Among all evaluated methods, FGO-ZUPT-POS achieves
the lowest errors across all three metrics.

Additionally, the cumulative distribution functions (CDFs)
of the horizontal position errors are plotted in Fig. 5 for both
EKF- and FGO-based methods. The rightmost CDF curve
corresponds to the proposed FGO-ZUPT-POS, demonstrating
the smallest horizontal error distribution among all approaches.
These experimental results validate the effectiveness of the
proposed constrained FGO-based algorithm and show that it
achieves superior positioning accuracy compared to traditional
constrained Kalman filter methods.


**Method** **Mean (m)** **RMS (m)** **Max (m)**


EKF-ZUPT 1.310 1.484 3.554


EKF-ZUPT-STEP 1.525 1.730 3.977


EKF-ZUPT-POS 0.631 0.706 1.533


EKF-ZUPT-POS-STEP 1.029 1.134 2.259


FGO-ZUPT 0.446 0.510 1.113


FGO-ZUPT-STEP 0.282 0.331 0.903


FGO-ZUPT-POS 0.238 0.270 0.601


FGO-ZUPT-POS-STEP **0.131** **0.153** **0.337**


TABLE I: Horizontal Error Statistics for the Right Foot.


**Method** **Mean (m)** **RMS (m)** **Max (m)**


EKF-ZUPT 3.338 3.904 7.085


EKF-ZUPT-STEP 1.427 1.607 3.713


EKF-ZUPT-POS 3.057 3.367 6.414


EKF-ZUPT-POS-STEP 1.068 1.181 2.348


FGO-ZUPT 1.788 2.169 4.474


FGO-ZUPT-STEP 1.201 1.414 2.888


FGO-ZUPT-POS 0.488 0.566 1.101


FGO-ZUPT-POS-STEP **0.368** **0.425** **0.963**


TABLE II: Horizontal Error Statistics for the Left Foot.


V. C ONCLUSION

This paper presented a constrained FGO-based networked
inertial navigation system designed for pedestrian localization. Unlike conventional Kalman Filter-based methods, the



**Method** 90% **(m)** 95% **(m)** 99% **(m)**


EKF-ZUPT 2.269 2.656 3.235


EKF-ZUPT-STEP 2.723 3.115 3.694


EKF-ZUPT-POS 1.078 1.206 1.363


EKF-ZUPT-POS-STEP 1.699 1.827 2.107


FGO-ZUPT 0.799 0.904 1.088


FGO-ZUPT-STEP 0.507 0.688 0.862


FGO-ZUPT-POS 0.427 0.499 0.585


FGO-ZUPT-POS-STEP **0.248** **0.281** **0.305**


TABLE III: 90%, 95% and 99% error bound for the Right
Foot.


**Method** 90% **(m)** 95% **(m)** 99% **(m)**


EKF-ZUPT 6.177 6.483 6.771


EKF-ZUPT-STEP 2.515 2.777 3.223


EKF-ZUPT-POS 5.111 5.597 5.998


EKF-ZUPT-POS-STEP 1.744 1.890 2.133


FGO-ZUPT 3.609 3.968 4.362


FGO-ZUPT-STEP 2.300 2.479 2.809


FGO-ZUPT-POS 0.904 1.013 1.077


FGO-ZUPT-POS-STEP **0.692** **0.793** **0.944**


TABLE IV: 90%, 95% and 99% error bound for the Left Foot.















−2 −1 0 1 2 3


X Po ition (m)



−2 −1 0 1 2 3


X Po ition (m)


|Col1|Left|
|---|---|
|2<br>3<br>4<br>on (m)||
|2<br>3<br>4<br>on (m)||
|Y Po iti||
|−2<br>−1<br>0<br><br>0<br>1<br>||
|−2<br>−1<br>0<br><br>0<br>1<br>||


|Col1|Right|
|---|---|
|2<br>3<br>4<br>on (m)||
|2<br>3<br>4<br>on (m)||
|Y Po iti||
|−2<br>−1<br>0<br><br>0<br>1<br>||
|−2<br>−1<br>0<br><br>0<br>1<br>||



Fig. 2: The comparison between the ground truth (blue) and
the estimated trajectory of FGO-ZUPT-POS-STEP (orange).















−2 −1 0 1 2 3


X Po ition (m)



−2 −1 0 1 2 3


X Po ition (m)


|Left|Col2|
|---|---|
|2<br>3<br>4<br>on (m)<br>Left|2<br>3<br>4<br>on (m)<br>Left|
|2<br>3<br>4<br>on (m)<br>Left||
|2<br>3<br>4<br>on (m)<br>Left||
|Y Po iti||
|−2<br>−1<br>0<br><br>0<br>1<br>||


|Right<br>4<br>3<br>(m)<br>2 on|Col2|
|---|---|
|2<br>3<br>4<br>on (m)<br>Right||
|2<br>3<br>4<br>on (m)<br>Right||
|Y Po iti||
|−2<br>−1<br>0<br><br>0<br>1<br>||



Fig. 3: The comparison between the ground truth (blue) and
the estimated trajectory of EKF-ZUPT-POS-STEP (orange).


|5<br>4|Col2|
|---|---|
|||
|||
|||
|||
|0<br>20<br>40<br>60<br><br>|80<br>100<br>12<br>|


|1.0<br>0.8<br>0.6<br>0.4<br>0.2|Col2|
|---|---|
|.2<br>0.4<br>0.6<br>0.8<br>1.0<br>||
|.2<br>0.4<br>0.6<br>0.8<br>1.0<br>||
|.2<br>0.4<br>0.6<br>0.8<br>1.0<br>|~~EKF-ZUPT~~<br>EKF-ZUPT<br>-Step<br>EKF-ZUPT<br>-Pos<br>EKF-ZUPT<br>-Pos-Step<br>|


0.0



Left Foot Pos. Meas. VS GT


Time (s)


|5<br>4|Col2|Col3|
|---|---|---|
||||
||||
||||
||||
|0<br>20<br>|40<br>60<br>80<br>|100<br>12|











Right Foot Pos. Meas. VS GT


Time (s)



Fig. 4: Position measurements horizontal errors.









|1.0<br>0.8<br>0.6<br>0.4<br>0.2|Col2|Col3|
|---|---|---|
|.2<br>0.4<br>0.6<br>0.8<br>1.0<br>|||
|.2<br>0.4<br>0.6<br>0.8<br>1.0<br>|||
|.2<br>0.4<br>0.6<br>0.8<br>1.0<br>|~~EKF~~<br>EKF<br>EKF<br>EKF<br>|~~-ZUPT~~<br>-ZUPT<br>-Step<br>-ZUPT<br>-Pos<br>-ZUPT<br>-Pos-Step<br>|


0.0



0 1 2 3 4 5 6 7


Error (m)



0.0 0.5 1.0 1.5 2.0 2.5 3.0 3.5 4.0


Error (m)



Fig. 5: The cumulative distribution function of horizontal
position errors for EKF-based and FGO-based approaches for
each foot.


proposed approach fully exploits temporal correlations across
states, observations, and constraints throughout the entire batch
of navigation data. Specifically, we introduced a novel integration strategy for inequality constraints by augmenting the
nonlinear optimization problem with a differentiable softmax
penalty term, ensuring stable and efficient optimization.
Experimental validation conducted using real-world pedestrian datasets demonstrated the superior performance of our
proposed method. Quantitative results clearly show that the
constrained FGO-based algorithm consistently outperforms
conventional constrained Kalman filter approaches, yielding
significantly lower mean, RMS, and maximum positioning
errors. These improvements highlight the benefits of explicitly
modeling and exploiting temporal and constraint correlations
across multiple epochs within a unified optimization framework.



R EFERENCES


[1] J. A. Farrell, _Aided Navigation: GPS with High Rate Sensors_ . McGrawHill, Inc., 2008.

[2] P. D. Groves, “Principles of gnss, inertial, and multisensor integrated
navigation systems, [book review],” _IEEE Aerospace and Electronic_
_Systems Magazine_, vol. 30, no. 2, pp. 26–27, 2015.

[3] I. Skog, P. Handel, J.-O. Nilsson, and J. Rantakokko, “Zero-velocity
detection—an algorithm evaluation,” _IEEE transactions on biomedical_
_engineering_, vol. 57, no. 11, pp. 2657–2666, 2010.

[4] C. Yang and E. Blasch, “Kalman filtering with nonlinear state constraints,” _IEEE Transactions on Aerospace and Electronic Systems_,
vol. 45, no. 1, pp. 70–84, 2009.

[5] J. De Geeter, H. Van Brussel, J. De Schutter, and M. Decr´eton,
“A smoothly constrained kalman filter,” _IEEE transactions on pattern_
_analysis and machine intelligence_, vol. 19, no. 10, pp. 1171–1177, 1997.

[6] Y. Hu, Y. Ketema, R. McGovern, J. Jean, A. Jonason, D. GebreEgziabher, and J. Hanson, “Networked inertial navigation with constraints generated by neural networks,” in _Proceedings of the 2022_
_International Technical Meeting of The Institute of Navigation_, 2022,
pp. 1405–1419.

[7] D. Simon and T. L. Chia, “Kalman filtering with state equality constraints,” _IEEE transactions on Aerospace and Electronic Systems_,
vol. 38, no. 1, pp. 128–136, 2002.

[8] D. Simon, _Optimal State Estimation: Kalman, H Infinity, and Nonlinear_
_Approaches_ . John Wiley & Sons, 2006.

[9] M. Kaess, H. Johannsson, R. Roberts, V. Ila, J. J. Leonard, and
F. Dellaert, “isam2: Incremental smoothing and mapping using the bayes
tree,” _The International Journal of Robotics Research_, vol. 31, no. 2, pp.
216–235, 2012.

[10] C. Forster, L. Carlone, F. Dellaert, and D. Scaramuzza, “Imu preintegration on manifold for efficient visual-inertial maximum-a-posteriori
estimation,” in _Robotics: Science and Systems XI_, 2015.

[11] I. Skog, J.-O. Nilsson, D. Zachariah, and P. H¨andel, “Fusing the
information from two navigation systems using an upper bound on
their maximum spatial separation,” in _2012 International Conference_
_on Indoor Positioning and Indoor Navigation (IPIN)_ . IEEE, 2012, pp.
1–5.

[12] C. Forster and et al, “On-manifold preintegration for real-time visual–
inertial odometry,” _IEEE Transactions on Robotics_, vol. 33, no. 1, pp.
1–21, 2016.

[13] H. Kim and H. Park, “Nonnegative matrix factorization based on alternating nonnegativity constrained least squares and active set method,”
_SIAM journal on matrix analysis and applications_, vol. 30, no. 2, pp.
713–730, 2008.

[14] F. Dellaert, “Factor graphs and gtsam: A hands-on introduction,” _Geor-_
_gia Institute of Technology, Tech. Rep_, vol. 2, p. 4, 2012.

[[15] PhaseSpace, “The impulse x2e motion capture system,” https://www.](https://www.phasespace.com/x2e-motion-capture/)
[phasespace.com/x2e-motion-capture/, 2025, accessed: 2025-01-28.](https://www.phasespace.com/x2e-motion-capture/)

[16] W. Hu, Y. Hu, M. Stas, and J. A. Farrell, “Optimization-based outlier
accommodation for tightly coupled rtk-aided inertial navigation systems
in urban environments,” in _2024 IEEE 27th International Conference on_
_Intelligent Transportation Systems (ITSC)_, 2024, pp. 2165–2171.

[[17] Xsens, “Xsens DOT User Manual,” https://www.xsens.com/hubfs/](https://www.xsens.com/hubfs/Downloads/Manuals/Xsens%20DOT%20User%20Manual.pdf)
[Downloads/Manuals/Xsens%20DOT%20User%20Manual.pdf, 2025, ac-](https://www.xsens.com/hubfs/Downloads/Manuals/Xsens%20DOT%20User%20Manual.pdf)
cessed: 2025-01-28.


