# Design and Implementation of an Inertial Navigation System for Pedestrians Based on a Low-Cost MEMS IMU

Francesco Montorsi _[∗]_, Fabrizio Pancaldi _[†]_ and Giorgio M. Vitetta _[∗]_

_∗_ Department of Engineering “Enzo Ferrari”, University of Modena and Reggio Emilia
Modena, Italy, Email: {francesco.montorsi, giorgio.vitetta}@unimore.it

_†_ Department of Science and Methods for Engineering, University of Modena and Reggio Emilia
Modena, Italy, Email: fabrizio.pancaldi@unimore.it



_**Abstract**_ **—Inertial navigation systems for pedestrians are**
**infrastructure-less and can achieve sub-meter accuracy in the**
**short/medium period. However, when low-cost inertial measure-**
**ment units (IMU) are employed for their implementation, they**
**suffer from a slowly growing drift between the true pedestrian**
**position and the corresponding estimated position. In this paper**
**we illustrate a novel solution to mitigate such a drift by:**
**a) using only accelerometer and gyroscope measurements (no**
**magnetometers required); b) including the sensor error model**
**parameters in the state vector of an extended Kalman filter;**
**c) adopting a novel soft heuristic for foot stance detection and**
**for zero-velocity updates. Experimental results evidence that our**
**inertial-only navigation system can achieve similar or better**
**performance with respect to pedestrian dead-reckoning systems**
**presented in related studies, although the adopted IMU is less**
**accurate than more expensive counterparts.**


I. I NTRODUCTION


In an _inertial navigation system_ (INS) the position of a
mobile agent is tracked by means of an _inertial measurement_
_unit_ (IMU) carried by the agent itself. IMU-based INSs can
provide a _low-cost_ and _infrastructure-less_ solution to accurate
indoor navigation in the short/medium term. Unluckily, in
the medium/long term they usually suffer from a “drift”
phenomenon [1], which originates from the noise and from any
small bias in the accelerations and angular velocities sensed
by the IMU.
Recently, substantial attention has been devoted to _pedes-_
_trian dead-reckoning_ (PDR) INSs, where the prior knowledge
of human walking patterns is exploited to reset, at least
partially, the accumulated errors due to various error sources
(e.g., the time-variant biases of IMUs). This approach has
been first proposed in [2], where the periods during which
the pedestrian’s foot is still on the ground are detected and
exploited to introduce some corrections (the so-called _zero_
_velocity updates_ (ZUPTs)) in the tracking filter. Further advances have been developed in [1], [3]–[5]. In particular, in

[1] and [3] an _extended Kalman filter_ (EKF) processing IMU
measurements exploits various heuristics to compensate for
the drift due to time-variant biases and measurement noise.

In [4] and [5], instead, additional measurements (from RFID
devices) are adopted to mitigate the drift phenomenon.



In this manuscript, starting from the methods and the results
illustrated in [1], [6], we develop a novel INS based only
on a low-cost IMU which performs PDR employing an EKF.
Unlike previous approaches, the proposed solution relies on:


1) Accelerometer and gyroscope measurements only (magnetometer sensors are often completely unreliable in
indoor environments and other technologies for accurate
localization are expensive).
2) A rigorous approach to the kinematic modelling of IMU
measurements; this involves the use of a large EKF state
vector, including both physical variables (e.g., agent
position and heading) and quantities referring to the
_sensor error models_ (SEMs).
3) A new soft (rather than hard) heuristic for foot stance
detection which increases the overall accuracy of the
INS.

This manuscript is organized as follows. In Section II, the
employed IMU and its calibration procedure are described.
The proposed PDR-INS is illustrated in Section III, whereas
its performance is assessed in Section IV. Finally, in Section
V some conclusions are provided.
_Notations_ : The _probability density function_ (pdf) of a _ran-_
_dom vector_ (rv) **R** evaluated at the point **r** is denoted as
_f_ ( **r** ); _N_ ( **r** ; **m** _,_ **Σ** ) denotes the pdf of a Gaussian rv **R** having
mean **m** and covariance matrix **Σ**, evaluated at the point
**r** ; _∥_ **x** _∥_ denotes the _L_ [2] norm of vector **x** ; the expressions
_{_ **x** _i_ _}_ _[k]_ _i_ =1 [and] **[ x]** [1:] _[k]_ [ both denote the sequence] **[ x]** [1] _[,]_ **[ x]** [2] _[, ...,]_ **[ x]** _[k]_ [.]
_g_ ≜ 9 _._ 80665 m _/_ s [2] denotes the gravitational acceleration;
finally, _⊙_ denotes the quaternion multiplication [7].


II. IMU D ESCRIPTION AND C ALIBRATION


In our PDR INS a mobile agent is equipped with a lowcost IMU, called RazorIMU [8] and fixed on one of his/her
feet using shoes’ laces (e.g., see [1], [3]–[5]). It is important
to note that the IMU-sensed quantities are expressed in _body_
(or _sensor_ ) _frame_, i.e., they are referred to a right-handed
coordinate frame centered on the IMU with axes parallel to
the sensor sides; this frame is different from the so called
_navigation frame_, which is a right-handed coordinate frame
centered on some point of the navigation map and whose _x_


and _y_ axes are parallel to Earth ground and _z_ axis points away
from Earth.

The RazorIMU is a programmable device equipped with
3-axis accelerometers, gyroscopes and magnetometers; our
firmware outputs their measurements in “raw mode”, i.e., as
integer numbers, so that a calibration procedure is required.
The tri-axial accelerometer calibration procedure we adopted
is similar to that described in [9], [10], but does not require
any additional hardware (besides the IMU itself). It relies on
the SEM (assuming a still sensor) [9], [10]


**a** _[m]_ = **G** _a_ **a** + **b** _[a]_ + **n** _[a]_ (1)


where **a** _[m]_ _∈_ Z [3] is the vector of _measured_ accelerations (in
body frame), **a** _∈_ R [3] is the vector of _true_ accelerations (in
body frame), **G** _a_ _∈_ R [3] _[×]_ [3] is the _gain matrix_ (diagonal if only
scale factors are accounted for, or a generic invertible matrix
if cross-couplings are also accounted for), **b** _[a]_ _∈_ R [3] is the
_bias_ vector, in body frame, and **n** _[a]_ _∈_ R [3] is the _noise_ vector
(in body frame) and is assumed to be _additive Gaussian noise_
(AGN) with covariance matrix **Σ** _a_ = _σ_ _a_ [2] **[I]** [3] [. The calibration]
task for the accelerometer consists of estimating **G** _a_ and **b** _[a]_

on the basis of _N · P_ measured vectors _{{_ **a** _[m]_ _i,p_ _[}]_ _i_ _[N]_ =1 _[}]_ _[P]_ _p_ =1 [(in]
our setup _N_ = 500 and _P_ = 16), referring to _P_ unknown
orientations of the still sensor (in the navigation frame). The
**b** optimal (in theˆ _[a]_ of the terms _mean square error_ **G** _a_ and **b** _[a]_ appearing in (1) are given by sense) estimators **G** [ˆ] _a_ and



expensive dedicated hardware platform, so that **b** [ˆ] _[ω]_ = 0 and
the value provided in the gyroscope datasheet [8] for **G** [ˆ] _ω_ have
been adopted.


III. T HE PDR INS

Our INS performs similarly to some other navigation systems described in the technical literature (e.g., see [1]), but is
based on a different approach and, in particular, on a set of
rigorous kinematic equations relating the quantities sensed by
the IMU with its orientation and 3D position. After describing
the structure of the state vector, the dynamic models and the
measurement models, we describe the use of an EKF for
estimating the posterior distribution of the state vector. Finally,
we focus on a soft algorithm for foot stance detection.


_A. State Vector_

In our INS the state vector **x** _k_ of the mobile agent wearing
the IMU is defined as


_n▷b_ _b,b▷n_ _T_ _D_
**x** _k_ ≜ � **p** _k_ _,_ **v** _k_ _,_ **a** _k_ _, q_ _k_ _[,]_ **[ a]** _[b]_ _k_ _[,]_ _**[ ω]**_ _k_ _,_ **b** _[a]_ _k_ _[,]_ **[ b]** _[ω]_ _k_ � _∈_ R (7)


where _k_ is the time-index of the discrete-time tracking filter for
navigation, **p** _k_ _∈_ R [3], **v** _k_ _∈_ R [3] and **a** _k_ _∈_ R [3] are the position,
the velocity and the acceleration of the IMU sensor, measured
in m, m _/_ s and m _/_ s [2], respectively; _q_ _k_ _[n▷b]_ _∈_ H 1 is a (random)
_quaternion_ representing the transformation which produces,
given a vector in navigation coordinates, a vector in body
coordinates [7]; **a** _[b]_ _k_ [and] _**[ ω]**_ _b,b▷n_ _k_ _∈_ R [3] are the acceleration (in
body frame) and the angular velocity (from body to navigation
frame, resolved in body coordinate frame [6]), measured in
m _/_ s [2] and rad _/_ s, respectively; **b** _[a]_ _k_ _[∈]_ [R] [3] [ and] **[ b]** _[ω]_ _k_ _[∈]_ [R] [3] [ are]
the bias vectors of the accelerometer and of the gyroscope,
expressed in body coordinate frame and measured in m _/_ s [2]

and rad _/_ s, respectively; finally, _D_ = 25 is the size of **x** _k_ .
_b,b▷n_
Note that: a) **a** _[b]_ _k_ [and] _**[ ω]**_ _k_ are the (noisy) observable
variables; b) all the other variables can be _pseudo-observed_ to
enhance the system stability whenever the foot is (approximately) still; c) **b** _[a]_ _k_ [and] **[ b]** _[ω]_ _k_ [represent “fine” bias vectors, and play]
a complementary role with respect to **b** [ˆ] _[a]_ and **b** [ˆ] _[ω]_, respectively,
which account for time-variant and turn-on dependent biases;
d) the vector **x** _k_ (7) has an heterogeneous structure, since it
consists of quantities of interest for the end-user of the INS
(namely, **p** _k_ and **v** _k_ ), quantities relating **p** _k_ and **v** _k_ to the
_b,b▷n_
sensor outputs (namely, **a** _k_, _q_ _k_ _[n▷b]_ [,] **[ a]** _[b]_ _k_ [,] _**[ ω]**_ _k_ ) and quantities
related to the SEMs of accelerometers and gyroscopes ( **b** _[a]_ _k_
and **b** _[ω]_ _k_ [, respectively); e) including the IMU-sensed quantities]
_b,b▷n_
( **a** _[b]_ _k_ [,] _**[ ω]**_ _k_ ) in **x** _k_ is important since impulsive noise (due to
hardware instability of low-cost sensors) may affect the IMU
output and an accurate dynamic modelling of ( _k_ + 1)-th step
sensor orientation ( _q_ _k_ _[n▷b]_ +1 [) requires the knowledge of the] _[ k]_ [-th]
_b,b▷n_
step angular velocity ( _**ω**_ _k_ ).


_B. Dynamic and Measurement Models_

The dynamic models adopted for the elements of **x** _k_ (7)
can be summarised as follows. The Taylor-expansion models
(e.g., see [6], [11, Sec. 4.3])

**p** _k_ +1 = **p** _k_ + **v** _k_ _· T_ _s_ + [1] 2 **[a]** _[k]_ _[ ·][ T]_ [ 2] _s_ [+] **[ n]** _[p,k]_ (8)



**G** ˆ _a_ _,_ ˆ **b** _[a]_ [�] = arg min
� ( **[G]** [˜] _[,]_ **[b]** [˜] ) _[∈G×B]_



_P_
� _r_ _p_ � **G** ˜ _,_ ˜ **b** _,_ ¯ **a** _[m]_ _p_ � (2)

_p_ =1



_N_
where ¯ **a** _[m]_ _p_ [is the mean of the measurements] � **a** _[m]_ _i,p_ � _i_ =1 [and]



_r_ _p_ � **G** ˜ _,_ ˜ **b** _,_ ¯ **a** _[m]_ _p_ � ≜ **a** ˜ min _p_ _∈A_



˜ ˜ ¯ _m_ 2
��� **Ga** _p_ + ˜ **b** _−_ **a** _p_ ��� (3)



Once calibration is completed, the true acceleration vector
may be estimated as


ˆ
**a** = **G** [ˆ] _[−]_ _a_ [1] **a** _[m]_ _−_ **b** [ˆ] _[a]_ [�] _._ (4)
�


Regarding the gyroscopes, a SEM similar to (1), i.e.,


_**ω**_ _[m]_ = **G** _ω_ _**ω**_ + **b** _[ω]_ + **n** _[ω]_ (5)


has been exploited to devise our calibration procedure; here
_**ω**_ _[m]_ _∈_ Z [3] is the vector of measured angular velocities (in body
frame), _**ω**_ _∈_ R [3] is the vector of true angular velocities (in
body frame), **G** _ω_ _∈_ R [3] _[×]_ [3] is the gain matrix (diagonal if only
scale factors are accounted for, or a generic invertible matrix
if cross-couplings are also accounted for), **b** _[ω]_ _∈_ R [3] is the bias
vector (in body frame), and **n** _[ω]_ _∈_ R [3] is the noise vector (in
body frame) and is assumed to be AGN with covariance matrix
**Σ** _ω_ = _σ_ _ω_ [2] **[I]** [3] [. Similarly to (4), the true vector] _**[ ω]**_ [ is estimated]

as

ˆ
_**ω**_ = **G** [ˆ] _[−]_ _ω_ [1] _**ω**_ _[m]_ _−_ **b** [ˆ] _[ω]_ [�] (6)
�


where **G** [ˆ] _ω_ and **b** [ˆ] _[ω]_ denote the estimated bias vector and gain
matrix of the gyroscope, respectively. However, unlike accelerometer calibration, calibration of gyroscopes requires an


and

**v** _k_ +1 = **v** _k_ + **a** _k_ _· T_ _s_ + **n** _v,k_ (9)


have been employed for the vectors **p** _k_ and **v** _k_, respectively;
here _T_ _s_ denotes the sampling period of the INS (1 _/_ 100 Hz
in our case) and the vectors **n** _p,k_ and **n** _v,k_ are AGN terms
affecting **p** _k_ and **v** _k_, respectively. The model


_n▷b_
**a** _k_ +1 = _R_ _[T]_ ( _q_ _k_ [)] **[ a]** _[b]_ _k_ [+] **[ g]** [ +] **[ n]** _[a,k]_ (10)


has been used for **a** _k_, where _R_ ( _q_ _k_ _[n▷b]_ [)][ is the rotation matrix]
associated with the quaternion _q_ _k_ _[n▷b]_ (and thus representing
the transformation from navigation to body frame), **g** ≜

[0 _,_ 0 _, −g_ ] _[T]_ is the gravity vector in the navigation frame and
**n** _a,k_ is AGN.
A further model relates the orientation of the sensor (rep_b,b▷n_
resented by _q_ _k_ _[n▷b]_ [) to the angular velocity] _**[ ω]**_ _k_ and is given
by (e.g., see [6, Eq. (4.11), Eq. (4.20d)] and [7, Sec. 11.5])



_C. The EKF_


The goal of the INS is the sequential estimation of the
hidden state vector **x** _k_ representing the mobile agent given
the sequence of IMU measurements _{_ **z** 0: _k_ _}_, i.e., the sequential
estimation of the posterior pdf _f_ ( **x** _k_ _|_ **z** 0: _k_ ). Since our dynamic
model is non-linear (see (10) and (11)), a non-linear filter, such
as an EKF, needs to be employed to solve this problem. It is
important to mention that: a) the EKF alternates a _prediction_
_step_ with an _update step_ ; b) it estimates the first two moments
of the posterior pdf _f_ ( **x** _k_ _|_ **z** 0: _k_ ), namely, the mean state vector
**x** ˆ [EKF] _k_ and the state vector covariance matrix **P** [ˆ] [EKF] _k_ [, in a recursive]
fashion. In particular, given ˆ **x** [EKF] _k_ and **P** [ˆ] [EKF] _k_ [, the EKF estimates]
( _prediction_ step) [12]


**x** ˆ EKF _k_ +1 _|k_ [=] **[ q]** [ (ˆ] **[x]** EKF _k_ [)] **P** ˆ EKF _k_ +1 _|k_ [=] **[ J]** _[q]_ _k_ **[P]** [ˆ] EKF _k_ [(] **[J]** _[q]_ _k_ [)] _[T]_ [ +] **[ Q]**


where ˆ **x** [EKF] _k_ +1 _|k_ [and][ ˆ] **[P]** [EKF] _k_ +1 _|k_ [denote the][ (] _[k]_ [+1)][-th state mean and]
covariance, respectively, which can be predicted on the basis of
the information available at the _k_ -th step; here **J** _[q]_ _k_ [≜] _[∂]_ **[q]** _∂_ [(] **x** **[x]** [)] ˆ

��� **x** _k_
is the _D × D_ Jacobian matrix [1] for our (non-linear) dynamic
model. Then, the EKF evaluates ( _update_ step) [12]:

**s** _k_ +1 _|k_ = **z** _k_ _−_ **r** � **x** ˆ EKF _k_ +1 _|k_ �

**S** _k_ +1 _|k_ = **J** _[r]_ _k_ **[P]** [ˆ] EKF _k_ +1 _|k_ [(] **[J]** _k_ _[r]_ [)] _[T]_ [ +] **[ R]**

**K** _k_ +1 _|k_ = **P** [ˆ] EKF _k_ +1 _|k_ [(] **[J]** _k_ _[r]_ [)] _[T]_ **[ S]** _[−]_ _k_ +1 [1] _|k_
**x** ˆ EKF _k_ +1 [= ˆ] **[x]** EKF _k_ +1 _|k_ [+] **[ K]** _[k]_ [+1] _[|][k]_ **[s]** _[k]_ [+1] _[|][k]_
**P** ˆ EKF _k_ +1 [= (] **[I]** _[ −]_ **[K]** _k_ +1 _|k_ **[J]** _[r]_ _k_ [)ˆ] **[P]** EKF _k_ +1 _|k_


where **r** _k_ +1 _|k_ is the innovation residual and **S** _k_ +1 _|k_ its estimated covariance matrix, **K** _k_ +1 _|k_ is the Kalman gain, ˆ **x** [EKF] _k_ +1 [is]
the new estimate of the state vector mean and **P** [ˆ] [EKF] _k_ +1 [is its]



_n▷b_ _−_ _[T]_ _b,b▷n_
_q_ _k_ +1 [= exp] � 2 _**[ω]**_ _k_



_n▷b_
_⊙_ _q_ _k_ + **n** _q,k_ (11)
�



where **n** _q,k_ is AGN.
Finally, the simple “random walk” models


**a** _[b]_ _k_ +1 [=] **[ a]** _[b]_ _k_ [+] **[ n]** _[a,k]_ (12)


_b,b▷n_ _b,b▷n_
_**ω**_ _k_ +1 [=] _**[ ω]**_ _k_ + **n** _ω,k_ (13)

**b** _[a]_ _k_ +1 [=] **[ b]** _[a]_ _k_ [+] **[ n]** _[b]_ _[a]_ _[,k]_ (14)

**b** _[ω]_ _k_ +1 [=] **[ b]** _[ω]_ _k_ [+] **[ n]** _[b]_ _[ω]_ _[,k]_ (15)


_b,b▷n_
have been selected for the filtered states **a** _[b]_ _k_ [and] _**[ ω]**_ _k_, and for
the sensor biases **b** _[a]_ _k_ [and] **[ b]** _[ω]_ _k_ [, where the] _[ {]_ **[n]** _[·][,k]_ _[}]_ [ terms denote]
AGN contributions.

Regarding measurements models, simple linear relations
involving only quantities in the body frame may be adopted,
thanks to the structure chosen for **x** _k_ (7):


**z** _[f]_ _k_ [=] **[ a]** _k_ _[b]_ [+] **[ b]** _[a]_ _k_ [+] **[ m]** _[a,k]_ (16)


_b,b▷n_
**z** _[ω]_ _k_ [=] _**[ ω]**_ _k_ + **b** _[ω]_ _k_ [+] **[ m]** _[ω,k]_ (17)


Here **z** _[f]_ _k_ [= ˆ] **[a]** [ (see (4)) and] **[ z]** _k_ _[ω]_ [= ˆ] _**[ω]**_ [ (see (6)) denote the]
_calibrated_ force and angular velocity measurements provided
by the IMU and the vectors **m** _a,k_, **m** _ω,k_ represent the AGN
terms affecting the measurements.
The _dynamic_ models (8)-(15) can be summarised as


_f_ ( **x** _k_ +1 _|_ **x** _k_ ) = _N_ ( **x** _k_ +1 ; **q** ( **x** _k_ ) _,_ **Q** ) (18)


whereas the _measurement_ models (16)-(17) can be summarised

as
_f_ ( **z** _k_ _|_ **x** _k_ ) = _N_ ( **z** _k_ ; **r** ( **x** _k_ ) _,_ **R** ) (19)


where **z** _k_ ≜ [ **z** _[f]_ _k_ _[,]_ **[ z]** _k_ _[ω]_ []] _[T]_ _[ ∈]_ [R] _[M]_ [ (with] _[ M]_ [ = 6][), the vector]
functions **q** ( _·_ ) and **r** ( _·_ ) are defined by (8)-(15) and by (16)(17), respectively, and **Q** and **R** are _D × D_ and _M × M_
diagonal covariance matrices for the AGN terms. Regarding
these matrices, it is worth mentioning that a) they may have a
strong impact on the EKF stability and b) the choice of their
diagonal values can be based, in practice, on some careful
tuning procedure (involving _D_ + _M_ = 31 parameters).



**r** ( **x** )

is
_∂_ **x** ˆ
��� **x** _k_ +1 _|k_



_∂_ **r** ( **x** )
estimated covariance matrix; moreover, **J** _[r]_ _k_ [≜] _∂_ **x**



the _M × D_ Jacobian matrix for the measurement model.

It is worth noting that: a) in any EKF, at the end of the _k_ -th
iteration only the quantities ˆ **x** [EKF] _k_ and **P** [ˆ] [EKF] _k_ need to be saved
and this substantially simplifies the INS implementation; b)
given these quantities, the posterior distribution _f_ ( **x** _k_ _|_ **z** 0: _k_ )
is estimated by the EKF as _N_ **x** _k_ ; ˆ **x** [EKF] _k_ _[,]_ [ ˆ] **[P]** [EKF] _k_ ; c) the ini� �
tialisation of the INS represent a critical task, since initial
errors cannot be mitigated by the EKF. As far as the last
point is concerned, **P** [ˆ] [EKF] 0 = **Q** has been selected for the initial
covariance matrix, whereas the initial state vector ˆ **x** [EKF] 0 has
been estimated assuming the foot still in a known position;
unfortunately, further details cannot be provided for space
limitations.


_D. Foot Stance Detection_


Even if the EKF illustrated in the previous Paragraph
includes the sensor biases **b** _[a]_ _k_ [and] **[ b]** _[ω]_ _k_ [in] **[ x]** _[k]_ [, due to the]
lack of robust models and, in particular, to the lack of bias
observations, the tracking of such quantities mitigates but


1 This matrix cannot be put in a simple analytical form, so that its evaluation
requires use of computer algebra systems.


does not completely compensate for sensor inaccuracies. In
practice, the residual biases may quickly disrupt the INS
tracking since their effects accumulate over time. The effects
of these error sources can be mitigated exploiting some a
priori knowledge about the typical human walking pattern
and, in particular, the fact at the end of each step the foot
lies approximately still on the ground for a short period
(typically, 0 _._ 1 _−_ 0 _._ 2 s ); during such a period, the value of
most of the elements of **x** _k_ are known a priori and the EKF
state can be adjusted accordingly. In practice, the EKF can be
provided with some “pseudo-measurements”, usually known
as ZUPTs [2], whenever a detection algorithm, processing the
IMU measurements in parallel to the EKF, detects a “foot still
event”. In our work, a foot stance detection algorithm inspired
by [1, Sec. II.C] has been used. This algorithm evaluates four
logical “condition signals” � _C_ _i_ [1] _[, C]_ _i_ [2] _[, C]_ _i_ [3] _[, C]_ _i_ [4] � associated with
the IMU measurements **z** _k_ and generated as



_C_ _i_ [1] [≜]


_C_ _i_ [2] [≜]


_C_ _i_ [3] [≜]


_C_ _i_ [4] [≜]



_f_
1 _γ_ _a,_ min _<_ **z** _i_ _< γ_ _a,_ max
��� ���
�0 otherwise

1 _σ_ � **z** _[f]_ _i−S_ : _i_ + _S_ � _< σ_ _a,_ max
�0 otherwise


1 _∥_ **z** _[ω]_ _i_ _[∥]_ _[< γ]_ _[ω,]_ [max]

0 otherwise
�

1 _σ_ � **z** _[ω]_ _i−S_ : _i_ + _S_ � _< σ_ _ω,_ max

0 otherwise
�



for _i ∈{k −_ _F, ..., k_ + _F_ _}_, where _σ_ ( **x** 1 _,_ **x** 2 _, ...,_ **x** _N_ ) denotes the standard deviation of the magnitude of the vectors
_{_ **x** 1 _,_ **x** 2 _, ...,_ **x** _N_ _}_, _F_ is the size of the windows used for step
detection, _S_ is the size of the window used for the computation
of _σ_ ( _·_ ), and _γ_ _a,_ max, _σ_ _a,_ max, _γ_ _ω,_ max and _σ_ _ω,_ max represent proper
thresholds. An _hard_ detection algorithm based on the condition
signals defined above has been proposed in [1, Sec. II.C];
it decides that the foot is “still”, during the _k_ -th time step,
if [�] _j_ _[k]_ = [+] _k_ _[F]_ _−F_ _[C]_ _j_ [1] _[C]_ _j_ [2] _[C]_ _j_ [3] _[>]_ _F_ 2 [. Here, we propose to use a] _[ soft]_

variant whose output is the _soft foot still_ (SFS) signal



SFS _k_ ≜ [1]

_F_



_k_ + _F_
� _C_ _i_ [1] _[C]_ _i_ [2] _[C]_ _i_ [3] _[C]_ _i_ [4]


_i_ = _k−F_



which ranges, for the _k_ -th time step, from zero (moving foot)
to one (the foot is very likely to be still on the ground). Then,
whenever SFS _k_ _> γ_ SFS ( _γ_ SFS _∈_ [0; 1] is a fixed threshold), a
“foot still event” begins and the EKF is fed with the pseudo
measurements


[ˆ **p** EKF _s_ []] 1:2 [=] **[ z]** _[xy]_ [ = [] **[p]** _[k]_ []] 1:2 [+] **[ m]** _[xy,k]_ (20)

0 = _z_ _[z]_ = [ **p** _k_ ] 3 + _m_ _z,k_ (21)

**0** = **z** _[v]_ = **v** _k_ + **m** _v,k_ (22)

**0** = **z** _[a]_ = **a** _k_ + **m** _a,k_ (23)

_−_ **g** = **z** _[a]_ _[b]_ = _R_ _[T]_ ( _q_ _k_ _n▷b_ [)] **[ a]** _[b]_ _k_ [+] **[ m]** _a_ _[b]_ _,k_ (24)

_∥_ **g** _∥_ = **z** _[a]_ _[b]_ = �� **a** _bk_ �� + _m_ _a_ _b_ _,k_ (25)



**0** = **z** _[ω]_ = _**ω**_ _b,b▷n_ _k_ + **m** _ω,k_ (26)


ˆ _n▷b_
**a** = **z** _[b]_ _k_ _[a]_ [=] **[ b]** _[a]_ _k_ _[−]_ _[R]_ [ (] _[q]_ _k_ [)] **[ g]** [ +] **[ m]** _[b]_ _[a]_ _[,k]_ (27)


ˆ
_**ω**_ = **z** _[b]_ _k_ _[ω]_ [=] **[ b]** _[ω]_ _k_ [+] **[ m]** _[b]_ _[ω]_ _[,k]_ (28)


where _s_ is the time step corresponding to the beginning of the
current “foot still event” (so that ˆ **p** [EKF] _s_ represents the position
where the foot is still) and the vectors _{_ **m** _·,k_ _}_ denote the
AGN terms of the pseudo-measurement models. To avoid
discontinuities in the tracked path, the variance of these noise
terms is modulated in a _soft_ way on the basis of the SFS _k_
signal. In practice, the soft ZUPT pseudo-measurement model


_f_ ( **z** _[p]_ _k_ _[|]_ **[x]** _[k]_ [) =] _[ N]_ [ (] **[z]** _[p]_ _k_ [;] **[ r]** _[p]_ [(] **[x]** _[k]_ [)] _[,]_ [ [1 +] _[ K]_ _[p]_ [(1] _[ −]_ [SFS] _[k]_ [)]] **[ R]** _[p]_ [)] (29)


is adopted where **z** _[p]_ _k_ [≜] [[] **[z]** _[xy]_ _[, z]_ _[z]_ _[,]_ **[ z]** _[v]_ _[, ...,]_ **[ z]** _k_ _[b]_ _[ω]_ []] _[T]_ _[ ∈]_ [R] _[M]_ _[ p]_ [ (with]
_M_ _[p]_ = 20); **R** _[p]_ is the diagonal covariance matrix collecting all
variance values of the _{_ **m** _·,k_ _}_ terms; the vector function **r** _[p]_ ( _·_ )
_∂_ **r** _[p]_ ( **x** )
can be easily derived from (20)-(28); **J** _[r]_ _k_ _[p]_ [≜] _∂_ **x** ˆ is

��� **x** _k_ +1 _|k_

the _M_ _[p]_ _×_ _D_ Jacobian matrix associated with the measurement

model (29) and _K_ _[p]_ is a parameter introduced to modulate
the variance of ZUPT pseudo-measurements. Note that the is
the value of _K_ _[p]_, the higher will be the variances associated
to **z** _[p]_ _k_ [pseudo-measurement when SFS] _[k]_ [ =] _[ γ]_ [SFS] [; then, as SFS] _[k]_
goes from _γ_ SFS to 1, the variances associated to **z** _[p]_ _k_ [decrease]
smoothly to the values collected in **R** _[p]_ . This approach ensures
that the tracked state vector ˆ **x** [EKF] _k_ smoothly transitions to the
“reset” values defined by (20)-(28), when ZUPTs are injected
in the EKF.

Finally, it is worth noting that the pseudo-measurements
(20), (21), (22), (27) and (28) allow to “observe” otherwise
unobservable state vector components and thus to “reset”
errors they might contain.


IV. I NDOOR N AVIGATION T ESTS


An experimental campaign has been carried out to acquire
various sets of measurements generated by an agent equipped
with the IMU described in Section II and repeating the same
test trajectory _N_ _rep_ = 10 times in an indoor environment.
These measurement sets have been stored on a notebook

and then processed offline. The test trajectory contains long
straight lines, 90 deg turns, short and long stops (e.g., to turn
on/off lights, to open/close doors, etc); the initial and final
positions coincide and the _total travelled distance_ (TTD) _L_ TTD
associated to such test walk is _L_ TTD _≃_ 300 m .
An example of the resulting INS-estimated agent path [2]

is shown in Fig. 1. It is easy to recognize that the “drift”
phenomenon mentioned in Section I is present, although in
a very limited amount (specially considering the many loops
walked in the same verse by the agent).
To quantify the performance of the INS usually the quantity
_ϵ_ TTD ≜ _L_ TTD 1 �� **p** ˆ EKF 0 _−_ **p** ˆ [EKF] _N_ _s_ �� is exploited [1], where _N_ _s_ is the
last time step in the recorded measurement set; of course,


2 Note that the values of the parameters introduced throughout the paper
and used to produce such results have been properly _tuned_ by means of an
automated search procedure, but the resulting values cannot be shown for
space limitations; see [13] for more details.


45


40


35


30


25


20


15


10














|Col1|IMU|ARW/BI coefficient|Unit<br>√|
|---|---|---|---|
|gyro<br>cel.|RazorIMU<br>Xsens MTi<br>RazorIMU|_N_ = [5_._2_,_ 12_._1_,_ 5_._6]_ ·_ 10_−_3<br>|( _◦/_s)_ /_<br>Hz<br>|
|gyro<br>cel.|RazorIMU<br>Xsens MTi<br>RazorIMU|_B_ = [3_,_ 18_,_ 4_._4]_ ·_ 10_−_3<br>_N_ = [45_,_ 41_,_ 36]_ ·_ 10_−_3<br>_B_ = [7_,_ 7_,_ 5]_ ·_ 10_−_3<br>_N_ = [5_._5_,_ 5_._1_,_ 7_._6]_ ·_ 10_−_3<br>_B_ = [609_,_ 590_,_ 732]_ ·_ 10_−_6|_◦/_s<br>( _◦/_s)_ /_<br>~~_√_~~Hz<br>_◦/_s<br>~~� ~~m_/_s2~~~~<br>_/_<br>~~_√_~~Hz<br>m_/_s2<br><br>|



5


0


-5

0 10 20 30 40 50 60 70


xd[m]


Figure 1. The agent trajectory estimated by the INS described in Section III
for a specific repetition. The checkpoints approximating the ground truth are
indicated by blue crosses; the corresponding points estimated by the INS are
indicated by red crosses.


for a closed test path and an ideal INS, _ϵ_ TTD = 0. In our
tests, for the _N_ _rep_ repetitions of the test walk, the _ϵ_ TTD figure
of merit was _{_ 1 _._ 4 _,_ 0 _._ 5 _,_ 4 _._ 7 _,_ 1 _._ 5 _,_ 7 _._ 2 _,_ 1 _._ 6 _,_ 8 _._ 8 _,_ 10 _._ 1 _,_ 10 _._ 4 _,_ 12 _._ 1 _}_ ;
these results can be compared with those obtained in [1,
Table II]; in such contribution, when the magnetometer is not
employed, the reported range for _ϵ_ TTD is 2 _−_ 10. These results
show that our INS achieves similar performance to that of

[1], despite the key difference that in [1] the Xsens MTi IMU
has been employed. Such an IMU has higher accuracy (and
higher costs) than the RazorIMU; to quantify such a difference,
the noise of the IMU sensors can be modelled analysing,
by means of the Allan variance method, long sequences of
sensor outputs acquired while the sensor is still. In our case,
24h of RazorIMU accelerometer and gyroscope data, acquired
at the sampling frequency _f_ _s_ = 100 Hz have been recorded
and analysed; the results, in terms of the standard _N_ and _B_
coefficients representing _acceleration/angular velocity random_
_walk_ (ARW) and _bias instability_ (BI) noise contributions, are
listed in Table I, together with the results reported in [14, Table
III] for the Xsens MTi IMU. The comparison between the two
IMUs shows that: a) the Xsens MTi has better matching among
the sensors mounted on the _x_, _y_ and _z_ axis; b) the Xsens MTi
IMU offers much better accelerometer performance. Moreover,
it is important to note that the RazorIMU calibration has
been carried out at a fixed temperature while the Xsens IMUs
employ temperature-dependent calibration factors.
In summary, the values of _ϵ_ TTD characterizing our INS are
comparable to the values reported in [1, Table II] (when the
magnetometer sensors are not used) although we employed an
IMU with worse noise and bias characteristics (of course, our
IMU is also cheaper and thus lowers system costs).


V. C ONCLUSIONS


In this manuscript, a novel INS has been derived integrating
exact kinematic models, SEM in the EKF state vector and a
novel _soft_ heuristic to detect foot steps. Our experimental tests



Xsens MTi _N_ = [900 _,_ 950 _,_ 850] _·_ 10 _[−]_ [6] ~~�~~ m _/_ s 2 ~~�~~ _/_ ~~_√_~~ Hz

_B_ = [230 _,_ 270 _,_ 290] _·_ 10 _[−]_ [6] m _/_ s [2]


Table I

C OMPARISON BETWEEN THE R AZOR IMU AND THE X SENS MT I IMU.


have evidenced that: a) a good accuracy can be achieved in
tracking a mobile agent on the short/medium period; b) our
INS performs similarly to other state-of-art INS PDR solutions
but uses a lower-cost IMU and does not employ magnetometers which are often unreliable in indoor environments. Future

work will focus the integration of map-awareness and radio
measurements in the proposed INS in order to further improve
robustness and long-term accuracy.


R EFERENCES


[1] A. R. Jiménez, F. Seco, J. C. Prieto, and J. Guevara Rosas, “Indoor pedestrian navigation using an INS/EKF framework for yaw drift reduction
and a foot-mounted IMU,” in _Workshop on Positioning Navigation and_
_Communication_, Dresden, 2010, pp. 135–143.

[2] E. Foxlin, “Pedestrian tracking with shoe-mounted inertial sensors,”
_IEEE Comput. Graph. Appl._, vol. 25, no. 6, pp. 38–46, Nov. 2005.

[3] A. R. Jiménez, F. Seco, F. Zampella, J. C. Prieto, and J. Guevara Rosas,
“Improved Heuristic Drift Elimination (iHDE) for pedestrian navigation
in complex buildings,” in _Int. Conf. on Indoor Positioning and Indoor_
_Navigation_, Guimaraes, 2011, pp. 1–8.

[4] A. R. Jiménez, F. Seco, J. C. Prieto, and J. Guevara Rosas, “Accurate
Pedestrian Indoor Navigation by Tightly Coupling Foot-Mounted IMU
and RFID Measurements,” _IEEE Trans. Instrum. Meas._, vol. 61, no. 1,
pp. 178–189, Jan. 2012.

[5] B. Krach and P. Roberston, “Cascaded estimation architecture for
integration of foot-mounted inertial sensors,” in _IEEE/ION Position,_
_Location and Navigation Symp._, Monterey, CA, 2008, pp. 112–119.

[6] J. Hol, “Pose Estimation and Calibration Algorithms for Vision and
Inertial Sensors,” Ph.D. dissertation, Linköping University, 2008.

[7] J. B. Kuipers, _Quaternions and Rotation Sequences: A Primer with_
_Applications to Orbits, Aerospace, and Virtual Reality_ . Princeton
University Press, 1999.

[8] “9 Degrees of Freedom Razor IMU SEN-10736 schematic and sensors’
datasheets,” Available online at http://www.sparkfun.com.

[9] P. Batista, C. Silvestre, P. Oliveira, and B. Cardeira, “Accelerometer
Calibration and Dynamic Bias and Gravity Estimation: Analysis, Design,
and Experimental Evaluation,” _IEEE Trans. Control Syst. Technol._,
vol. 19, no. 5, pp. 1128–1137, Sep. 2011.

[10] M. Sipos, P. Paces, J. Rohac, and P. Novacek, “Analyses of Triaxial
Accelerometer Calibration Algorithms,” _IEEE Sensors J._, vol. 12, no. 5,
pp. 1157–1165, May 2012.

[11] X. Rong Li and V. Jilkov, “Survey of maneuvering target tracking. Part
I. Dynamic models,” _IEEE Trans. Aerosp. and Electron. Syst._, vol. 39,
no. 4, pp. 1333–1364, Oct. 2003.

[12] R. E. Kalman, “A New Approach to Linear Filtering and Prediction
Problems,” _Trans. of the ASME – J. of Basic Eng._, vol. 82, no. Series
D, pp. 35–45, 1960.

[13] F. Montorsi, “Localization and Tracking for Indoor Environments,”
Ph.D. dissertation, University of Modena and Reggio Emilia, 2013.

[14] F. Hoflinger, J. Muller, M. Tork, L. Reindl, and W. Burgard, “A wireless
micro inertial measurement unit (IMU),” in _IEEE Int. Instrumentation_
_and Measurement Technology Conf._, Graz, 2012, pp. 2578–2583.


